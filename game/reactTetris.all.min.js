"use strict";function loadIssuesNumber(a){var b,c;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(c=JSON.parse(b.responseText),a=c)},b.open("GET","https://api.github.com/repos/hibooboo2/react_Tetris/issues",!1),b.send(),c}function Piece(a,b,c,d){this.tetromino=a?a:allTetromino[0],this.rotation=c?c:0,this.position=b?b:{x:3,y:0},this.type=d?d:5}function PieceEngine(){this.rand=function(){var a=new Piece(this.shuffledPieces.pop(),{x:3,y:0},0,6);return a},this.draw=function(){for(;this.que.length<7;)0===this.shuffledPieces.length&&(this.shuffledPieces=this.shuffle(allTetromino)),this.que.unshift(this.rand());var a=this.que.pop();return a.type=1,a},this.fromHeld=function(a){return new Piece(a.tetromino,{x:3,y:0},0,1)},this.shuffle=function(a){a=a.slice(0);for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},this.shuffledPieces=allTetromino.slice(0),this.que=[],this.shuffle(this.shuffledPieces);for(var a=0;a<this.shuffledPieces.length;a++)this.que.push(new Piece(this.shuffledPieces[a]));return this.shuffle(this.shuffledPieces),this.Piece=Piece,this}function loadIssuesNumber(a){var b,c;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(c=JSON.parse(b.responseText),a=c)},b.open("GET","https://api.github.com/repos/hibooboo2/react_Tetris/issues",!1),b.send(),c}function Piece(a,b,c,d){this.tetromino=a?a:allTetromino[0],this.rotation=c?c:0,this.position=b?b:{x:3,y:0},this.type=d?d:5}function PieceEngine(){this.rand=function(){var a=new Piece(this.shuffledPieces.pop(),{x:3,y:0},0,6);return a},this.draw=function(){for(;this.que.length<7;)0===this.shuffledPieces.length&&(this.shuffledPieces=this.shuffle(allTetromino)),this.que.unshift(this.rand());var a=this.que.pop();return a.type=1,a},this.fromHeld=function(a){return new Piece(a.tetromino,{x:3,y:0},0,1)},this.shuffle=function(a){a=a.slice(0);for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},this.shuffledPieces=allTetromino.slice(0),this.que=[],this.shuffle(this.shuffledPieces);for(var a=0;a<this.shuffledPieces.length;a++)this.que.push(new Piece(this.shuffledPieces[a]));return this.shuffle(this.shuffledPieces),this.Piece=Piece,this}function loadIssuesNumber(a){var b,c;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(c=JSON.parse(b.responseText),a=c)},b.open("GET","https://api.github.com/repos/hibooboo2/react_Tetris/issues",!1),b.send(),c}function Piece(a,b,c,d){this.tetromino=a?a:allTetromino[0],this.rotation=c?c:0,this.position=b?b:{x:3,y:0},this.type=d?d:5}function PieceEngine(){this.rand=function(){var a=new Piece(this.shuffledPieces.pop(),{x:3,y:0},0,6);return a},this.draw=function(){for(;this.que.length<7;)0===this.shuffledPieces.length&&(this.shuffledPieces=this.shuffle(allTetromino)),this.que.unshift(this.rand());var a=this.que.pop();return a.type=1,a},this.fromHeld=function(a){return new Piece(a.tetromino,{x:3,y:0},0,1)},this.shuffle=function(a){a=a.slice(0);for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},this.shuffledPieces=allTetromino.slice(0),this.que=[],this.shuffle(this.shuffledPieces);for(var a=0;a<this.shuffledPieces.length;a++)this.que.push(new Piece(this.shuffledPieces[a]));return this.shuffle(this.shuffledPieces),this.Piece=Piece,this}function loadIssuesNumber(a){var b,c;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(c=JSON.parse(b.responseText),a=c)},b.open("GET","https://api.github.com/repos/hibooboo2/react_Tetris/issues",!1),b.send(),c}function Piece(a,b,c,d){this.tetromino=a?a:allTetromino[0],this.rotation=c?c:0,this.position=b?b:{x:3,y:0},this.type=d?d:5}function PieceEngine(){this.rand=function(){var a=new Piece(this.shuffledPieces.pop(),{x:3,y:0},0,6);return a},this.draw=function(){for(;this.que.length<7;)0===this.shuffledPieces.length&&(this.shuffledPieces=this.shuffle(allTetromino)),this.que.unshift(this.rand());var a=this.que.pop();return a.type=1,a},this.fromHeld=function(a){return new Piece(a.tetromino,{x:3,y:0},0,1)},this.shuffle=function(a){a=a.slice(0);for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},this.shuffledPieces=allTetromino.slice(0),this.que=[],this.shuffle(this.shuffledPieces);for(var a=0;a<this.shuffledPieces.length;a++)this.que.push(new Piece(this.shuffledPieces[a]));return this.shuffle(this.shuffledPieces),this.Piece=Piece,this}function loadIssuesNumber(a){var b,c;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(c=JSON.parse(b.responseText),a=c)},b.open("GET","https://api.github.com/repos/hibooboo2/react_Tetris/issues",!1),b.send(),c}function Piece(a,b,c,d){this.tetromino=a?a:allTetromino[0],this.rotation=c?c:0,this.position=b?b:{x:3,y:0},this.type=d?d:5}function PieceEngine(){this.rand=function(){var a=new Piece(this.shuffledPieces.pop(),{x:3,y:0},0,6);return a},this.draw=function(){for(;this.que.length<7;)0===this.shuffledPieces.length&&(this.shuffledPieces=this.shuffle(allTetromino)),this.que.unshift(this.rand());var a=this.que.pop();return a.type=1,a},this.fromHeld=function(a){return new Piece(a.tetromino,{x:3,y:0},0,1)},this.shuffle=function(a){a=a.slice(0);for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},this.shuffledPieces=allTetromino.slice(0),this.que=[],this.shuffle(this.shuffledPieces);for(var a=0;a<this.shuffledPieces.length;a++)this.que.push(new Piece(this.shuffledPieces[a]));return this.shuffle(this.shuffledPieces),this.Piece=Piece,this}function loadIssuesNumber(a){var b,c;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(c=JSON.parse(b.responseText),a=c)},b.open("GET","https://api.github.com/repos/hibooboo2/react_Tetris/issues",!1),b.send(),c}function Piece(a,b,c,d){this.tetromino=a?a:allTetromino[0],this.rotation=c?c:0,this.position=b?b:{x:3,y:0},this.type=d?d:5}function PieceEngine(){this.rand=function(){var a=new Piece(this.shuffledPieces.pop(),{x:3,y:0},0,6);return a},this.draw=function(){for(;this.que.length<7;)0===this.shuffledPieces.length&&(this.shuffledPieces=this.shuffle(allTetromino)),this.que.unshift(this.rand());var a=this.que.pop();return a.type=1,a},this.fromHeld=function(a){return new Piece(a.tetromino,{x:3,y:0},0,1)},this.shuffle=function(a){a=a.slice(0);for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},this.shuffledPieces=allTetromino.slice(0),this.que=[],this.shuffle(this.shuffledPieces);for(var a=0;a<this.shuffledPieces.length;a++)this.que.push(new Piece(this.shuffledPieces[a]));return this.shuffle(this.shuffledPieces),this.Piece=Piece,this}function Piece(a,b,c,d){this.tetromino=a?a:allTetromino[0],this.rotation=c?c:0,this.position=b?b:{x:3,y:0},this.type=d?d:5}function PieceEngine(){this.rand=function(){var a=new Piece(this.shuffledPieces.pop(),{x:3,y:0},0,6);return a},this.draw=function(){for(;this.que.length<7;)0===this.shuffledPieces.length&&(this.shuffledPieces=this.shuffle(allTetromino)),this.que.unshift(this.rand());var a=this.que.pop();return a.type=1,a},this.fromHeld=function(a){return new Piece(a.tetromino,{x:3,y:0},0,1)},this.shuffle=function(a){a=a.slice(0);for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},this.shuffledPieces=allTetromino.slice(0),this.que=[],this.shuffle(this.shuffledPieces);for(var a=0;a<this.shuffledPieces.length;a++)this.que.push(new Piece(this.shuffledPieces[a]));return this.shuffle(this.shuffledPieces),this.Piece=Piece,this}function loadIssuesNumber(a){var b,c;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.onreadystatechange=function(){4==b.readyState&&200==b.status&&(c=JSON.parse(b.responseText),a=c)},b.open("GET","https://api.github.com/repos/hibooboo2/react_Tetris/issues",!1),b.send(),c}function Piece(a,b,c,d){this.tetromino=a?a:allTetromino[0],this.rotation=c?c:0,this.position=b?b:{x:3,y:0},this.type=d?d:5}function PieceEngine(){this.rand=function(){var a=new Piece(this.shuffledPieces.pop(),{x:3,y:0},0,6);return a},this.draw=function(){for(;this.que.length<7;)0===this.shuffledPieces.length&&(this.shuffledPieces=this.shuffle(allTetromino)),this.que.unshift(this.rand());var a=this.que.pop();return a.type=1,a},this.fromHeld=function(a){return new Piece(a.tetromino,{x:3,y:0},0,1)},this.shuffle=function(a){a=a.slice(0);for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a},this.shuffledPieces=allTetromino.slice(0),this.que=[],this.shuffle(this.shuffledPieces);for(var a=0;a<this.shuffledPieces.length;a++)this.que.push(new Piece(this.shuffledPieces[a]));return this.shuffle(this.shuffledPieces),this.Piece=Piece,this}var BoardEngine=function(){function a(){this.height=22,this.width=10,this.usedCells=[[]],this.newBoard(),this.settings={canHold:!0,useGhost:!0,canPreview:!0,fullScreen:!1,announcer:!0,useAutoSave:!1},this.gameOver=!1,this.paused=!0,this.justHeld=!1,this.score=new Score,this.fallingPiece=!1,this.heldPiece=!1,this.started=!1,this.pieceEngine=new PieceEngine}return a.prototype.gameOverConst="GameOver",a.prototype.gameOverErr=function(){throw this.gameOver=!0,this.gameOverConst},a.prototype.getCurrentBoard=function(){for(var a=[],b=0;b<this.height;b++){a[b]=[];for(var c=0;c<this.width;c++)a[b].push(this.usedCells[b][c].copy())}return this.fallingPiece&&(this.settings.useGhost&&this.fallingPiece.ghost(this).cells().map(function(b){a[b.y][b.x]=b.copy()}),this.fallingPiece.cells().map(function(b){a[b.y][b.x]=b.copy()})),a},a.prototype.getCell=function(a){var b=null;return this.cellOnBoard(a)?b=this.usedCells[a.y][a.x].copy():(b=new Cell(a.x,a.y),b.type=4),b},a.prototype.canAddCell=function(a){var b=this.getCell(a);return this.cellOnBoard(a)&&4!==b.type&&a.collides(b)&&3===b.type},a.prototype.canAddCells=function(a){for(var b=!0,c=0;c<a.length;c++)this.canAddCell(a[c])||(b=!1);return b},a.prototype.addCell=function(a){var b=!1;if(this.canAddCell(a)){var c=a.copy();c.type=2,this.usedCells[a.y][a.x]=c,b=!0}return b},a.prototype.cellOnBoard=function(a){return a.x<this.width&&a.y<this.height&&a.x>=0&&a.y>=0},a.prototype.addPiece=function(a){var b=!1;if(this.canAddPiece(a)){for(var c=a.cells(),d=0;d<c.length;d++)this.addCell(c[d]);b=!0}return this.clearLines(),a.equals(this.fallingPiece)&&b&&this.newFallingPiece(),b},a.prototype.clearLines=function(){var a=function(){for(var a=[],b=0;10>b;b++)a[b]=new Cell(0,b,"lightgrey","empty",3);return a},b=[];this.usedCells.map(function(a,c){var d=!0;return a.map(function(a){2!==a.type&&(d=!1)}),d&&b.push(c),d}),b.length>0&&this.score.didScore(b.length);for(var c=0;c<b.length;c++)this.usedCells.splice(b[c],1),this.usedCells.unshift(a()),this.usedCells.map(function(a,b){a.map(function(a,c){a.x=c,a.y=b})})},a.prototype.canAddPiece=function(a){var b=a.cells();return this.canAddCells(b)},a.prototype.holdPiece=function(){if(!this.justHeld&&this.settings.canHold){var a=this.heldPiece;this.heldPiece=this.fallingPiece,this.heldPiece.position={x:1,y:1},this.heldPiece.rotation=0,a?this.fallingPiece=this.pieceEngine.fromHeld(a):this.newFallingPiece(),this.justHeld=!0}},a.prototype.newFallingPiece=function(){this.isGameOver()||(this.fallingPiece=this.pieceEngine.draw(),this.justHeld=!1)},a.prototype.dropFallingPiece=function(){return this.fallingPiece.dropPiece(this),this.addPiece(this.fallingPiece),this.score.didScore(0),!0},a.prototype.rotateFallingClockWise=function(){return this.fallingPiece.rotateClockWise(this)},a.prototype.rotateFallingCounterClockWise=function(){return this.fallingPiece.rotateCounterClockWise(this)},a.prototype.shiftFallingLeft=function(){return this.fallingPiece.shiftLeft(this)},a.prototype.shiftFallingRight=function(){return this.fallingPiece.shiftRight(this)},a.prototype.moveFallingDown=function(){var a=this.fallingPiece.movePieceDown(this);return a&&this.score.didScore(5),a},a.prototype.restart=function(){this.newBoard(),this.gameOver=!1,this.justHeld=!1,this.level=0,this.fallingPiece=!1,this.heldPiece=!1,this.score=new Score,this.started=!1,this.paused=!0},a.prototype.newBoard=function(){for(var a=0;a<this.height;a++){this.usedCells[a]=[];for(var b=0;b<this.width;b++)this.usedCells[a][b]=new Cell(b,a,"lightgrey","empty",3)}},a.prototype.getFallingPiece=function(){return this.fallingPiece},a.prototype.isGameOver=function(){if(!this.gameOver){var a=[this.usedCells[0],this.usedCells[1]];a.map(function(a){a.map(function(a){2===a.type&&(this.gameOver=!0)})})}return this.gameOver?void this.gameOverErr():this.gameOver},a.prototype.fromJson=function(a){return a=JSON.parse(a),this.height=a.height,this.width=a.width,this.usedCells=a.usedCells.map(function(a){return a.map(function(a){return(new Cell).fromJson(a)})}),this.settings={canHold:a.settings.canHold,useGhost:a.settings.useGhost,canPreview:a.settings.canPreview,fullScreen:a.settings.fullScreen,announcer:a.settings.announcer,useAutoSave:a.settings.useAutoSave},this.gameOver=a.gameOver,this.justHeld=a.justHeld,this.score=(new Score).fromJson(a.score),this.fallingPiece=(new this.pieceEngine.newPiece).fromJson(a.fallingPiece),this.heldPiece=a.heldPiece,this.started=a.started,this},a.prototype.gravity=function(){this.paused||this.fallingPiece&&(this.moveFallingDown()||(this.settings.useAutoSave?(window.localStorage.board=JSON.stringify(this),console.log(window.localStorage.board)):window.localStorage.board=null,this.dropFallingPiece(),document.getElementById("TetrisSong").playbackRate=this.score.getPlaybackRate(),this.playBlock(this.fallingPiece.name())))},a.prototype.pause=function(){this.gameOver&&this.paused&&this.restart(),this.started&&(this.paused=!this.paused)},new a},Cell=function(a,b,c,d,e){this.x=a?a:0,this.y=b?b:0,this.color=c?c:"lightgrey",this.name=d?d:"empty",this.type=void 0!==e?e:5};Cell.prototype.types=["ghost","moving","placed","default","offMap","unused","preview"],Cell.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.color===a.color&&this.name===a.name&&this.type===a.type},Cell.prototype.getType=function(){return Cell.prototype.types[this.type]},Cell.prototype.copy=function(){var a=new Cell(this.x,this.y,this.color,this.name,this.type);return a},Cell.prototype.collides=function(a){return this.x===a.x&&this.y===a.y},Cell.prototype.canMove=function(a,b){var c=this.copy();return c.y+=b.y,c.x+=b.x,a.canAddCell(c)},Cell.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Cell.prototype.moveDown=function(a){var b=!1;return this.canMoveDown(a)&&(this.y+=1,b=!0),b},Cell.prototype.fromJson=function(a){return void 0===a.x&&(a=JSON.parse(a)),this.x=a.x,this.y=a.y,this.color=a.color,this.name=a.name,this.type=a.type,this};var keyMappings=function(){var a={65:"a",68:"d",76:"l",82:"r",83:"s",87:"w",37:"Left",39:"Right",40:"Down",38:"Up",32:"Space",13:"Enter",16:"Shift",192:"`"},b={drop:{"function":"dropFallingPiece",english:"Drop Current Piece."},pickAlevel:{"function":"pickAlevel",english:"Use this to skip to a tetris level"},softDrop:{"function":"moveFallingDown",english:"Soft Drop Current Piece"},rotateClockWise:{"function":"rotateFallingClockWise",english:"Rotate Piece ClockWise"},rotateCounterClockWise:{"function":"rotateFallingCounterClockWise",english:"Rotate Piece Counter ClockWise"},shiftRight:{"function":"shiftFallingRight",english:"Shift Piece Right"},shiftLeft:{"function":"shiftFallingLeft",english:"Shift Piece Left"},hold:{"function":"holdPiece",english:"Hold Piece"},restart:{"function":"restart",english:"Restart Game"},pause:{"function":"pause",english:"Play / Pause Game"},changeMapping:{"function":"changeMapping",english:"Switch mapping between Arrows and wasd"}},c={keys:{87:b.drop,83:b.softDrop,39:b.rotateClockWise,37:b.rotateCounterClockWise,68:b.shiftRight,65:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}},d={keys:{40:b.softDrop,87:b.drop,38:b.rotateClockWise,39:b.shiftRight,37:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}};return{"default":c,arrows:d}};Piece.prototype.getType=function(){return Cell.prototype.types[this.type]},Piece.prototype.copy=function(){return new Piece(this.tetromino,{x:this.position.x,y:this.position.y},this.rotation,this.type)},Piece.prototype.equals=function(a){return a.type===this.type&&this.position.x===a.position.x&&this.position.y===a.position.y&&this.rotation===a.rotation},Piece.prototype.name=function(){return this.tetromino.name},Piece.prototype.color=function(){return this.tetromino.color},Piece.prototype.collides=function(a){var b=!1;return this.cells().map(function(c){a.cells().map(function(a){c.collides(a)&&(b=!0)})}),b},Piece.prototype.collidesWithCell=function(a){var b=!1;return this.cells().map(function(c){c.collides(a)&&(b=!0)}),b},Piece.prototype.collidesWithCells=function(a){for(var b=!1,c=0;c<a.length;c++)this.collidesWithCell(a[c])&&(b=!0);return b},Piece.prototype.movePiece=function(a,b){var c=!1;return this.canMove(a,b)&&(this.position.y+=b.y,this.position.x+=b.x,c=!0),c},Piece.prototype.movePieceDown=function(a){var b={x:0,y:1};return this.movePiece(a,b)},Piece.prototype.canMove=function(a,b){var c={x:this.position.x+b.x,y:this.position.y+b.y};return this.cells().map(function(d){d.canMove(a,b)||(c=!1)}),c},Piece.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Piece.prototype.canRotate=function(a,b){var c=!0,d=this.rotation;return this.rotation=b,this.cells().map(function(b){var d=a.canAddCell(b);d||(c=!1)}),this.rotation=d,c},Piece.prototype.dropPiece=function(a){for(var b=this.position.y;this.movePieceDown(a););return this.position.y===b},Piece.prototype.ghost=function(a){var b=this.copy();return b.type=0,b.dropPiece(a),b},Piece.prototype.cells=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){f.map(function(f,h){if(f){var i=new Cell(h+b.x,g+b.y,c,d,e);a.push(i)}})}),a},Piece.prototype.cells2d=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){a[g]=[],f.map(function(f,h){var i=new Cell(h+b.x,g+b.y,c,d,f?e:5);a[g].push(i)})}),a},Piece.prototype.shiftLeft=function(a){var b={x:-1,y:0};return this.movePiece(a,b)},Piece.prototype.shiftRight=function(a){var b={x:1,y:0};return this.movePiece(a,b)},Piece.prototype.rotateClockWise=function(a){var b=!1,c=this.rotation+1;return c>this.tetromino.cells.length-1&&(c=0),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.rotateCounterClockWise=function(a){var b=!1,c=this.rotation-1;return 0>c&&(c=3),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.fromJson=function(a){return void 0===a.tetromino&&(a=JSON.parse(a)),a?(this.tetromino=a.tetromino,this.rotation=a.rotation,this.position={x:a.position.x,y:a.position.y},this.type=a.type,this):!1};var allTetromino=[{cells:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],name:"I",color:"Cyan"},{cells:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],name:"J",color:"Blue"},{cells:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],name:"L",color:"#ff8c00"},{cells:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],name:"O",color:"#ffd700"},{cells:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],name:"S",color:"Green"},{cells:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],name:"T",color:"Purple"},{cells:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],name:"Z",color:"Red"}],Score=function(){this.level=0,this._score=0,this.linesCleared=0,this.singles=0,this.doubles=0,this.triples=0,this.tetrises=0,this.comboCount=0,this.lastCleared=0,this.gameOver=!1};Score.prototype.linesToScore=["hardDrop","single","double","triple","tetris","softDrop"],Score.prototype._gameOver=function(){if(this.gameOver)throw"GameOver";return!1},Score.prototype.single=function(){this._gameOver()||(this._score+=100*(this.level+1),this.singles+=1)},Score.prototype["double"]=function(){this._gameOver()||(this._score+=300*(this.level+1),this.doubles+=1)},Score.prototype.triple=function(){this._gameOver||(this._score+=500*(this.level+1),this.triples+=1)},Score.prototype.tetris=function(){this._gameOver()||(this._score+=800*(this.level+1),this.tetrises+=1)},Score.prototype.combo=function(){this._gameOver()||(this._score+=50*this.comboCount*this.level,this.comboCount+=1)},Score.prototype.softDrop=function(){this._gameOver()||(this._score+=1*(this.level+1))},Score.prototype.hardDrop=function(a){if(!this._gameOver()){var b=2*(this.level+1)*(a+1)+20;this._score+=b}},Score.prototype.levelUp=function(a){this._gameOver()||(this.lastCleared+=a,(this.lastCleared>=this.levelUpFactor().lines||4===a&&this.lastCleared>=this.levelUpFactor().tetris)&&(this.lastCleared=0,this.level+=1))},Score.prototype.levelUpFactor=function(){return{lines:this.level/2*5,tetris:this.level/2*2}},Score.prototype.nextLevelUp=function(){return{linesToLevelUp:this.lastCleared+" / "+this.levelUpFactor().lines,linesFromTetris:this.lastCleared>=this.levelUpFactor().tetris}},Score.prototype.getValue=function(){return this._score},Score.prototype.getDelay=function(){return 800-50*this.level},Score.prototype.getPlaybackRate=function(){return.113*this.level+.8},Score.prototype.didScore=function(a){this._gameOver()||(this.linesCleared+=5!==a?a:0,this.levelUp(5!==a?a:0),this[Score.prototype.linesToScore[a]](a))},Score.prototype.fromJson=function(a){return void 0===a.level&&(a=JSON.parse(a)),this.level=a.level,this._score=a.score,this.linesCleared=a.linesCleared,this.singles=a.singles,this.doubles=a.doubles,this.triples=a.triples,this.tetrises=a.tetrises,this.comboCount=a.comboCount,this.lastCleared=a.lastCleared,this};var BoardEngine=function(){function a(){this.height=22,this.width=10,this.usedCells=[[]],this.newBoard(),this.settings={canHold:!0,useGhost:!0,canPreview:!0,fullScreen:!1,announcer:!0,useAutoSave:!1},this.gameOver=!1,this.paused=!0,this.justHeld=!1,this.score=new Score,this.fallingPiece=!1,this.heldPiece=!1,this.started=!1,this.pieceEngine=new PieceEngine}return a.prototype.gameOverConst="Game Over",a.prototype.gameOverErr=function(){throw this.gameOver=!0,this.gameOverConst},a.prototype.getCurrentBoard=function(){for(var a=[],b=0;b<this.height;b++){a[b]=[];for(var c=0;c<this.width;c++)a[b].push(this.usedCells[b][c].copy())}return this.fallingPiece&&(this.settings.useGhost&&this.fallingPiece.ghost(this).cells().map(function(b){a[b.y][b.x]=b.copy()}),this.fallingPiece.cells().map(function(b){a[b.y][b.x]=b.copy()})),a},a.prototype.getCell=function(a){var b=null;return this.cellOnBoard(a)?b=this.usedCells[a.y][a.x].copy():(b=new Cell(a.x,a.y),b.type=4),b},a.prototype.canAddCell=function(a){var b=this.getCell(a);return this.cellOnBoard(a)&&4!==b.type&&a.collides(b)&&3===b.type},a.prototype.canAddCells=function(a){for(var b=!0,c=0;c<a.length;c++)this.canAddCell(a[c])||(b=!1);return b},a.prototype.addCell=function(a){var b=!1;if(this.canAddCell(a)){var c=a.copy();c.type=2,this.usedCells[a.y][a.x]=c,b=!0}return b},a.prototype.cellOnBoard=function(a){return a.x<this.width&&a.y<this.height&&a.x>=0&&a.y>=0},a.prototype.addPiece=function(a){var b=!1;if(this.canAddPiece(a)){for(var c=a.cells(),d=0;d<c.length;d++)this.addCell(c[d]);b=!0}return this.clearLines(),a.equals(this.fallingPiece)&&b&&this.newFallingPiece(),b},a.prototype.clearLines=function(){var a=function(){for(var a=[],b=0;10>b;b++)a[b]=new Cell(0,b,"lightgrey","empty",3);return a},b=[];this.usedCells.map(function(a,c){var d=!0;return a.map(function(a){2!==a.type&&(d=!1)}),d&&b.push(c),d}),b.length>0&&this.score.didScore(b.length);for(var c=0;c<b.length;c++)this.usedCells.splice(b[c],1),this.usedCells.unshift(a()),this.usedCells.map(function(a,b){a.map(function(a,c){a.x=c,a.y=b})})},a.prototype.canAddPiece=function(a){var b=a.cells();return this.canAddCells(b)},a.prototype.holdPiece=function(){if(!this.justHeld&&this.settings.canHold){var a=this.heldPiece;this.heldPiece=this.fallingPiece,this.heldPiece.position={x:1,y:1},this.heldPiece.rotation=0,a?this.fallingPiece=this.pieceEngine.fromHeld(a):this.newFallingPiece(),this.justHeld=!0}},a.prototype.newFallingPiece=function(){this.isGameOver()||(this.fallingPiece=this.pieceEngine.draw(),this.justHeld=!1)},a.prototype.dropFallingPiece=function(){return this.fallingPiece.dropPiece(this),this.addPiece(this.fallingPiece),this.score.didScore(0),!0},a.prototype.rotateFallingClockWise=function(){return this.fallingPiece.rotateClockWise(this)},a.prototype.rotateFallingCounterClockWise=function(){return this.fallingPiece.rotateCounterClockWise(this)},a.prototype.shiftFallingLeft=function(){return this.fallingPiece.shiftLeft(this)},a.prototype.shiftFallingRight=function(){return this.fallingPiece.shiftRight(this)},a.prototype.moveFallingDown=function(){var a=this.fallingPiece.movePieceDown(this);return a&&this.score.didScore(5),a},a.prototype.restart=function(){this.newBoard(),this.gameOver=!1,this.justHeld=!1,this.level=0,this.fallingPiece=!1,this.heldPiece=!1,this.score=new Score,this.started=!1,this.paused=!0},a.prototype.newBoard=function(){for(var a=0;a<this.height;a++){this.usedCells[a]=[];for(var b=0;b<this.width;b++)this.usedCells[a][b]=new Cell(b,a,"lightgrey","empty",3)}},a.prototype.getFallingPiece=function(){return this.fallingPiece},a.prototype.isGameOver=function(){if(!this.gameOver){var a=[this.usedCells[0],this.usedCells[1]];a.map(function(a){a.map(function(a){2===a.type&&(this.gameOver=!0)})})}return this.gameOver?void this.gameOverErr():this.gameOver},a.prototype.fromJson=function(a){return a=JSON.parse(a),this.height=a.height,this.width=a.width,this.usedCells=a.usedCells.map(function(a){return a.map(function(a){return(new Cell).fromJson(a)})}),this.settings={canHold:a.settings.canHold,useGhost:a.settings.useGhost,canPreview:a.settings.canPreview,fullScreen:a.settings.fullScreen,announcer:a.settings.announcer,useAutoSave:a.settings.useAutoSave},this.gameOver=a.gameOver,this.justHeld=a.justHeld,this.score=(new Score).fromJson(a.score),this.fallingPiece=(new this.pieceEngine.newPiece).fromJson(a.fallingPiece),this.heldPiece=a.heldPiece,this.started=a.started,this},a.prototype.gravity=function(){this.paused||this.fallingPiece&&(this.moveFallingDown()||(this.settings.useAutoSave?(window.localStorage.board=JSON.stringify(this),console.log(window.localStorage.board)):window.localStorage.board=null,this.dropFallingPiece(),document.getElementById("TetrisSong").playbackRate=this.score.getPlaybackRate(),this.playBlock(this.fallingPiece.name())))},a.prototype.pause=function(){this.gameOver&&this.paused&&this.restart(),this.started&&(this.paused=!this.paused)},new a},Cell=function(a,b,c,d,e){this.x=a?a:0,this.y=b?b:0,this.color=c?c:"lightgrey",this.name=d?d:"empty",this.type=void 0!==e?e:5};Cell.prototype.types=["ghost","moving","placed","default","offMap","unused","preview"],Cell.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.color===a.color&&this.name===a.name&&this.type===a.type},Cell.prototype.getType=function(){return Cell.prototype.types[this.type]},Cell.prototype.copy=function(){var a=new Cell(this.x,this.y,this.color,this.name,this.type);return a},Cell.prototype.collides=function(a){return this.x===a.x&&this.y===a.y},Cell.prototype.canMove=function(a,b){var c=this.copy();return c.y+=b.y,c.x+=b.x,a.canAddCell(c)},Cell.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Cell.prototype.moveDown=function(a){var b=!1;return this.canMoveDown(a)&&(this.y+=1,b=!0),b},Cell.prototype.fromJson=function(a){return void 0===a.x&&(a=JSON.parse(a)),this.x=a.x,this.y=a.y,this.color=a.color,this.name=a.name,this.type=a.type,this};var keyMappings=function(){var a={65:"a",68:"d",76:"l",82:"r",83:"s",87:"w",37:"Left",39:"Right",40:"Down",38:"Up",32:"Space",13:"Enter",16:"Shift",192:"`"},b={drop:{"function":"dropFallingPiece",english:"Drop Current Piece."},pickAlevel:{"function":"pickAlevel",english:"Use this to skip to a tetris level"},softDrop:{"function":"moveFallingDown",english:"Soft Drop Current Piece"},rotateClockWise:{"function":"rotateFallingClockWise",english:"Rotate Piece ClockWise"},rotateCounterClockWise:{"function":"rotateFallingCounterClockWise",english:"Rotate Piece Counter ClockWise"},shiftRight:{"function":"shiftFallingRight",english:"Shift Piece Right"},shiftLeft:{"function":"shiftFallingLeft",english:"Shift Piece Left"},hold:{"function":"holdPiece",english:"Hold Piece"},restart:{"function":"restart",english:"Restart Game"},pause:{"function":"pause",english:"Play / Pause Game"},changeMapping:{"function":"changeMapping",english:"Switch mapping between Arrows and wasd"}},c={keys:{87:b.drop,83:b.softDrop,39:b.rotateClockWise,37:b.rotateCounterClockWise,68:b.shiftRight,65:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}},d={keys:{40:b.softDrop,87:b.drop,38:b.rotateClockWise,39:b.shiftRight,37:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}};return{"default":c,arrows:d}};Piece.prototype.getType=function(){return Cell.prototype.types[this.type]},Piece.prototype.copy=function(){return new Piece(this.tetromino,{x:this.position.x,y:this.position.y},this.rotation,this.type)},Piece.prototype.equals=function(a){return a.type===this.type&&this.position.x===a.position.x&&this.position.y===a.position.y&&this.rotation===a.rotation},Piece.prototype.name=function(){return this.tetromino.name},Piece.prototype.color=function(){return this.tetromino.color},Piece.prototype.collides=function(a){var b=!1;return this.cells().map(function(c){a.cells().map(function(a){c.collides(a)&&(b=!0)})}),b},Piece.prototype.collidesWithCell=function(a){var b=!1;return this.cells().map(function(c){c.collides(a)&&(b=!0)}),b},Piece.prototype.collidesWithCells=function(a){for(var b=!1,c=0;c<a.length;c++)this.collidesWithCell(a[c])&&(b=!0);return b},Piece.prototype.movePiece=function(a,b){var c=!1;return this.canMove(a,b)&&(this.position.y+=b.y,this.position.x+=b.x,c=!0),c},Piece.prototype.movePieceDown=function(a){var b={x:0,y:1};return this.movePiece(a,b)},Piece.prototype.canMove=function(a,b){var c={x:this.position.x+b.x,
y:this.position.y+b.y};return this.cells().map(function(d){d.canMove(a,b)||(c=!1)}),c},Piece.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Piece.prototype.canRotate=function(a,b){var c=!0,d=this.rotation;return this.rotation=b,this.cells().map(function(b){var d=a.canAddCell(b);d||(c=!1)}),this.rotation=d,c},Piece.prototype.dropPiece=function(a){for(var b=this.position.y;this.movePieceDown(a););return this.position.y===b},Piece.prototype.ghost=function(a){var b=this.copy();return b.type=0,b.dropPiece(a),b},Piece.prototype.cells=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){f.map(function(f,h){if(f){var i=new Cell(h+b.x,g+b.y,c,d,e);a.push(i)}})}),a},Piece.prototype.cells2d=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){a[g]=[],f.map(function(f,h){var i=new Cell(h+b.x,g+b.y,c,d,f?e:5);a[g].push(i)})}),a},Piece.prototype.shiftLeft=function(a){var b={x:-1,y:0};return this.movePiece(a,b)},Piece.prototype.shiftRight=function(a){var b={x:1,y:0};return this.movePiece(a,b)},Piece.prototype.rotateClockWise=function(a){var b=!1,c=this.rotation+1;return c>this.tetromino.cells.length-1&&(c=0),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.rotateCounterClockWise=function(a){var b=!1,c=this.rotation-1;return 0>c&&(c=3),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.fromJson=function(a){return void 0===a.tetromino&&(a=JSON.parse(a)),a?(this.tetromino=a.tetromino,this.rotation=a.rotation,this.position={x:a.position.x,y:a.position.y},this.type=a.type,this):!1};var allTetromino=[{cells:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],name:"I",color:"Cyan"},{cells:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],name:"J",color:"Blue"},{cells:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],name:"L",color:"#ff8c00"},{cells:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],name:"O",color:"#ffd700"},{cells:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],name:"S",color:"Green"},{cells:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],name:"T",color:"Purple"},{cells:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],name:"Z",color:"Red"}],Score=function(){this.level=0,this._score=0,this.linesCleared=0,this.singles=0,this.doubles=0,this.triples=0,this.tetrises=0,this.comboCount=0,this.lastCleared=0,this.gameOver=!1};Score.prototype.linesToScore=["hardDrop","single","double","triple","tetris","softDrop"],Score.prototype._gameOver=function(){if(this.gameOver)throw"GameOver";return!1},Score.prototype.single=function(){this._gameOver()||(this._score+=100*(this.level+1),this.singles+=1)},Score.prototype["double"]=function(){this._gameOver()||(this._score+=300*(this.level+1),this.doubles+=1)},Score.prototype.triple=function(){this._gameOver||(this._score+=500*(this.level+1),this.triples+=1)},Score.prototype.tetris=function(){this._gameOver()||(this._score+=800*(this.level+1),this.tetrises+=1)},Score.prototype.combo=function(){this._gameOver()||(this._score+=50*this.comboCount*this.level,this.comboCount+=1)},Score.prototype.softDrop=function(){this._gameOver()||(this._score+=1*(this.level+1))},Score.prototype.hardDrop=function(a){if(!this._gameOver()){var b=2*(this.level+1)*(a+1)+20;this._score+=b}},Score.prototype.levelUp=function(a){this._gameOver()||(this.lastCleared+=a,(this.lastCleared>=this.levelUpFactor().lines||4===a&&this.lastCleared>=this.levelUpFactor().tetris)&&(this.lastCleared=0,this.level+=1))},Score.prototype.levelUpFactor=function(){return{lines:this.level/2*5,tetris:this.level/2*2}},Score.prototype.nextLevelUp=function(){return{linesToLevelUp:this.lastCleared+" / "+this.levelUpFactor().lines,linesFromTetris:this.lastCleared>=this.levelUpFactor().tetris}},Score.prototype.getValue=function(){return this._score},Score.prototype.getDelay=function(){return 800-50*this.level},Score.prototype.getPlaybackRate=function(){return.113*this.level+.8},Score.prototype.didScore=function(a){this._gameOver()||(this.linesCleared+=5!==a?a:0,this.levelUp(5!==a?a:0),this[Score.prototype.linesToScore[a]](a))},Score.prototype.fromJson=function(a){return void 0===a.level&&(a=JSON.parse(a)),this.level=a.level,this._score=a.score,this.linesCleared=a.linesCleared,this.singles=a.singles,this.doubles=a.doubles,this.triples=a.triples,this.tetrises=a.tetrises,this.comboCount=a.comboCount,this.lastCleared=a.lastCleared,this};var BoardEngine=function(){function a(){this.height=22,this.width=10,this.usedCells=[[]],this.newBoard(),this.settings={canHold:!0,useGhost:!0,canPreview:!0,fullScreen:!1,announcer:!0,useAutoSave:!1},this.gameOver=!1,this.paused=!0,this.justHeld=!1,this.score=new Score,this.fallingPiece=!1,this.heldPiece=!1,this.started=!1,this.pieceEngine=new PieceEngine}return a.prototype.gameOverConst="Game Over",a.prototype.gameOverErr=function(){throw this.gameOver=!0,this.gameOverConst},a.prototype.getCurrentBoard=function(){for(var a=[],b=0;b<this.height;b++){a[b]=[];for(var c=0;c<this.width;c++)a[b].push(this.usedCells[b][c].copy())}return this.fallingPiece&&(this.settings.useGhost&&this.fallingPiece.ghost(this).cells().map(function(b){a[b.y][b.x]=b.copy()}),this.fallingPiece.cells().map(function(b){a[b.y][b.x]=b.copy()})),a},a.prototype.getCell=function(a){var b=null;return this.cellOnBoard(a)?b=this.usedCells[a.y][a.x].copy():(b=new Cell(a.x,a.y),b.type=4),b},a.prototype.canAddCell=function(a){var b=this.getCell(a);return this.cellOnBoard(a)&&4!==b.type&&a.collides(b)&&3===b.type},a.prototype.canAddCells=function(a){for(var b=!0,c=0;c<a.length;c++)this.canAddCell(a[c])||(b=!1);return b},a.prototype.addCell=function(a){var b=!1;if(this.canAddCell(a)){var c=a.copy();c.type=2,this.usedCells[a.y][a.x]=c,b=!0}return b},a.prototype.cellOnBoard=function(a){return a.x<this.width&&a.y<this.height&&a.x>=0&&a.y>=0},a.prototype.addPiece=function(a){var b=!1;if(this.canAddPiece(a)){for(var c=a.cells(),d=0;d<c.length;d++)this.addCell(c[d]);b=!0}return this.clearLines(),a.equals(this.fallingPiece)&&b&&this.newFallingPiece(),b},a.prototype.clearLines=function(){var a=function(){for(var a=[],b=0;10>b;b++)a[b]=new Cell(0,b,"lightgrey","empty",3);return a},b=[];this.usedCells.map(function(a,c){var d=!0;return a.map(function(a){2!==a.type&&(d=!1)}),d&&b.push(c),d}),b.length>0&&this.score.didScore(b.length);for(var c=0;c<b.length;c++)this.usedCells.splice(b[c],1),this.usedCells.unshift(a()),this.usedCells.map(function(a,b){a.map(function(a,c){a.x=c,a.y=b})})},a.prototype.canAddPiece=function(a){var b=a.cells();return this.canAddCells(b)},a.prototype.holdPiece=function(){if(!this.justHeld&&this.settings.canHold){var a=this.heldPiece;this.heldPiece=this.fallingPiece,this.heldPiece.position={x:1,y:1},this.heldPiece.rotation=0,a?this.fallingPiece=this.pieceEngine.fromHeld(a):this.newFallingPiece(),this.justHeld=!0}},a.prototype.newFallingPiece=function(){this.isGameOver()||(this.fallingPiece=this.pieceEngine.draw(),this.justHeld=!1)},a.prototype.dropFallingPiece=function(){return this.fallingPiece.dropPiece(this),this.addPiece(this.fallingPiece),this.score.didScore(0),!0},a.prototype.rotateFallingClockWise=function(){return this.fallingPiece.rotateClockWise(this)},a.prototype.rotateFallingCounterClockWise=function(){return this.fallingPiece.rotateCounterClockWise(this)},a.prototype.shiftFallingLeft=function(){return this.fallingPiece.shiftLeft(this)},a.prototype.shiftFallingRight=function(){return this.fallingPiece.shiftRight(this)},a.prototype.moveFallingDown=function(){var a=this.fallingPiece.movePieceDown(this);return a&&this.score.didScore(5),a},a.prototype.restart=function(){this.newBoard(),this.gameOver=!1,this.justHeld=!1,this.level=0,this.fallingPiece=!1,this.heldPiece=!1,this.score=new Score,this.started=!1,this.paused=!0},a.prototype.newBoard=function(){for(var a=0;a<this.height;a++){this.usedCells[a]=[];for(var b=0;b<this.width;b++)this.usedCells[a][b]=new Cell(b,a,"lightgrey","empty",3)}},a.prototype.getFallingPiece=function(){return this.fallingPiece},a.prototype.isGameOver=function(){if(!this.gameOver){var a=[this.usedCells[0],this.usedCells[1]];a.map(function(a){a.map(function(a){2===a.type&&(this.gameOver=!0)})})}return this.gameOver?void this.gameOverErr():this.gameOver},a.prototype.fromJson=function(a){return a=JSON.parse(a),this.height=a.height,this.width=a.width,this.usedCells=a.usedCells.map(function(a){return a.map(function(a){return(new Cell).fromJson(a)})}),this.settings={canHold:a.settings.canHold,useGhost:a.settings.useGhost,canPreview:a.settings.canPreview,fullScreen:a.settings.fullScreen,announcer:a.settings.announcer,useAutoSave:a.settings.useAutoSave},this.gameOver=a.gameOver,this.justHeld=a.justHeld,this.score=(new Score).fromJson(a.score),this.fallingPiece=(new this.pieceEngine.newPiece).fromJson(a.fallingPiece),this.heldPiece=a.heldPiece,this.started=a.started,this},a.prototype.gravity=function(){this.paused||this.fallingPiece&&(this.moveFallingDown()||(this.settings.useAutoSave?(window.localStorage.board=JSON.stringify(this),console.log(window.localStorage.board)):window.localStorage.board=null,this.dropFallingPiece(),document.getElementById("TetrisSong").playbackRate=this.score.getPlaybackRate(),this.playBlock(this.fallingPiece.name())))},a.prototype.pause=function(){this.gameOver&&this.paused&&this.restart(),this.started&&(this.paused=!this.paused)},new a},Cell=function(a,b,c,d,e){this.x=a?a:0,this.y=b?b:0,this.color=c?c:"lightgrey",this.name=d?d:"empty",this.type=void 0!==e?e:5};Cell.prototype.types=["ghost","moving","placed","default","offMap","unused","preview"],Cell.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.color===a.color&&this.name===a.name&&this.type===a.type},Cell.prototype.getType=function(){return Cell.prototype.types[this.type]},Cell.prototype.copy=function(){var a=new Cell(this.x,this.y,this.color,this.name,this.type);return a},Cell.prototype.collides=function(a){return this.x===a.x&&this.y===a.y},Cell.prototype.canMove=function(a,b){var c=this.copy();return c.y+=b.y,c.x+=b.x,a.canAddCell(c)},Cell.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Cell.prototype.moveDown=function(a){var b=!1;return this.canMoveDown(a)&&(this.y+=1,b=!0),b},Cell.prototype.fromJson=function(a){return void 0===a.x&&(a=JSON.parse(a)),this.x=a.x,this.y=a.y,this.color=a.color,this.name=a.name,this.type=a.type,this};var keyMappings=function(){var a={65:"a",68:"d",76:"l",82:"r",83:"s",87:"w",37:"Left",39:"Right",40:"Down",38:"Up",32:"Space",13:"Enter",16:"Shift",192:"`"},b={drop:{"function":"dropFallingPiece",english:"Drop Current Piece."},pickAlevel:{"function":"pickAlevel",english:"Use this to skip to a tetris level"},softDrop:{"function":"moveFallingDown",english:"Soft Drop Current Piece"},rotateClockWise:{"function":"rotateFallingClockWise",english:"Rotate Piece ClockWise"},rotateCounterClockWise:{"function":"rotateFallingCounterClockWise",english:"Rotate Piece Counter ClockWise"},shiftRight:{"function":"shiftFallingRight",english:"Shift Piece Right"},shiftLeft:{"function":"shiftFallingLeft",english:"Shift Piece Left"},hold:{"function":"holdPiece",english:"Hold Piece"},restart:{"function":"restart",english:"Restart Game"},pause:{"function":"pause",english:"Play / Pause Game"},changeMapping:{"function":"changeMapping",english:"Switch mapping between Arrows and wasd"}},c={keys:{87:b.drop,83:b.softDrop,39:b.rotateClockWise,37:b.rotateCounterClockWise,68:b.shiftRight,65:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}},d={keys:{40:b.softDrop,87:b.drop,38:b.rotateClockWise,39:b.shiftRight,37:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}};return{"default":c,arrows:d}};Piece.prototype.getType=function(){return Cell.prototype.types[this.type]},Piece.prototype.copy=function(){return new Piece(this.tetromino,{x:this.position.x,y:this.position.y},this.rotation,this.type)},Piece.prototype.equals=function(a){return a.type===this.type&&this.position.x===a.position.x&&this.position.y===a.position.y&&this.rotation===a.rotation},Piece.prototype.name=function(){return this.tetromino.name},Piece.prototype.color=function(){return this.tetromino.color},Piece.prototype.collides=function(a){var b=!1;return this.cells().map(function(c){a.cells().map(function(a){c.collides(a)&&(b=!0)})}),b},Piece.prototype.collidesWithCell=function(a){var b=!1;return this.cells().map(function(c){c.collides(a)&&(b=!0)}),b},Piece.prototype.collidesWithCells=function(a){for(var b=!1,c=0;c<a.length;c++)this.collidesWithCell(a[c])&&(b=!0);return b},Piece.prototype.movePiece=function(a,b){var c=!1;return this.canMove(a,b)&&(this.position.y+=b.y,this.position.x+=b.x,c=!0),c},Piece.prototype.movePieceDown=function(a){var b={x:0,y:1};return this.movePiece(a,b)},Piece.prototype.canMove=function(a,b){var c={x:this.position.x+b.x,y:this.position.y+b.y};return this.cells().map(function(d){d.canMove(a,b)||(c=!1)}),c},Piece.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Piece.prototype.canRotate=function(a,b){var c=!0,d=this.rotation;return this.rotation=b,this.cells().map(function(b){var d=a.canAddCell(b);d||(c=!1)}),this.rotation=d,c},Piece.prototype.dropPiece=function(a){for(var b=this.position.y;this.movePieceDown(a););return this.position.y===b},Piece.prototype.ghost=function(a){var b=this.copy();return b.type=0,b.dropPiece(a),b},Piece.prototype.cells=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){f.map(function(f,h){if(f){var i=new Cell(h+b.x,g+b.y,c,d,e);a.push(i)}})}),a},Piece.prototype.cells2d=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){a[g]=[],f.map(function(f,h){var i=new Cell(h+b.x,g+b.y,c,d,f?e:5);a[g].push(i)})}),a},Piece.prototype.shiftLeft=function(a){var b={x:-1,y:0};return this.movePiece(a,b)},Piece.prototype.shiftRight=function(a){var b={x:1,y:0};return this.movePiece(a,b)},Piece.prototype.rotateClockWise=function(a){var b=!1,c=this.rotation+1;return c>this.tetromino.cells.length-1&&(c=0),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.rotateCounterClockWise=function(a){var b=!1,c=this.rotation-1;return 0>c&&(c=3),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.fromJson=function(a){return void 0===a.tetromino&&(a=JSON.parse(a)),a?(this.tetromino=a.tetromino,this.rotation=a.rotation,this.position={x:a.position.x,y:a.position.y},this.type=a.type,this):!1};var allTetromino=[{cells:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],name:"I",color:"Cyan"},{cells:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],name:"J",color:"Blue"},{cells:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],name:"L",color:"#ff8c00"},{cells:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],name:"O",color:"#ffd700"},{cells:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],name:"S",color:"Green"},{cells:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],name:"T",color:"Purple"},{cells:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],name:"Z",color:"Red"}],Score=function(){this.level=0,this._score=0,this.linesCleared=0,this.singles=0,this.doubles=0,this.triples=0,this.tetrises=0,this.comboCount=0,this.lastCleared=0};Score.prototype.linesToScore=["hardDrop","single","double","triple","tetris","softDrop"],Score.prototype.single=function(){this._score+=100*(this.level+1),this.singles+=1},Score.prototype["double"]=function(){this._score+=300*(this.level+1),this.doubles+=1},Score.prototype.triple=function(){this._score+=500*(this.level+1),this.triples+=1},Score.prototype.tetris=function(){this._score+=800*(this.level+1),this.tetrises+=1},Score.prototype.combo=function(){this._score+=50*this.comboCount*this.level,this.comboCount+=1},Score.prototype.softDrop=function(){this._score+=1*(this.level+1)},Score.prototype.hardDrop=function(a){var b=2*(this.level+1)*(a+1)+20;this._score+=b},Score.prototype.levelUp=function(a){this.lastCleared+=a,(this.lastCleared>=this.levelUpFactor().lines||4===a&&this.lastCleared>=this.levelUpFactor().tetris)&&(this.lastCleared=0,this.level+=1)},Score.prototype.levelUpFactor=function(){return{lines:this.level/2*5,tetris:this.level/2*2}},Score.prototype.nextLevelUp=function(){return{linesToLevelUp:this.lastCleared+" / "+this.levelUpFactor().lines,linesFromTetris:this.lastCleared>=this.levelUpFactor().tetris}},Score.prototype.getValue=function(){return this._score},Score.prototype.getDelay=function(){return 800-50*this.level},Score.prototype.getPlaybackRate=function(){return.113*this.level+.8},Score.prototype.didScore=function(a){this.linesCleared+=5!==a?a:0,this.levelUp(5!==a?a:0),this[Score.prototype.linesToScore[a]](a)},Score.prototype.fromJson=function(a){return void 0===a.level&&(a=JSON.parse(a)),this.level=a.level,this._score=a.score,this.linesCleared=a.linesCleared,this.singles=a.singles,this.doubles=a.doubles,this.triples=a.triples,this.tetrises=a.tetrises,this.comboCount=a.comboCount,this.lastCleared=a.lastCleared,this};var BoardEngine=function(){function a(){this.height=22,this.width=10,this.usedCells=[[]],this.newBoard(),this.settings={canHold:!0,useGhost:!0,canPreview:!0,fullScreen:!1,announcer:!0,useAutoSave:!1},this.gameOver=!1,this.paused=!0,this.justHeld=!1,this.score=new Score,this.fallingPiece=!1,this.heldPiece=!1,this.started=!1,this.pieceEngine=new PieceEngine}return a.prototype.gameOverConst="Game Over",a.prototype.gameOverErr=function(){throw this.gameOver=!0,this.gameOverConst},a.prototype.getCurrentBoard=function(){for(var a=[],b=0;b<this.height;b++){a[b]=[];for(var c=0;c<this.width;c++)a[b].push(this.usedCells[b][c].copy())}return this.fallingPiece&&(this.settings.useGhost&&this.fallingPiece.ghost(this).cells().map(function(b){a[b.y][b.x]=b.copy()}),this.fallingPiece.cells().map(function(b){a[b.y][b.x]=b.copy()})),a},a.prototype.getCell=function(a){var b=null;return this.cellOnBoard(a)?b=this.usedCells[a.y][a.x].copy():(b=new Cell(a.x,a.y),b.type=4),b},a.prototype.canAddCell=function(a){var b=this.getCell(a);return this.cellOnBoard(a)&&4!==b.type&&a.collides(b)&&3===b.type},a.prototype.canAddCells=function(a){for(var b=!0,c=0;c<a.length;c++)this.canAddCell(a[c])||(b=!1);return b},a.prototype.addCell=function(a){var b=!1;if(this.canAddCell(a)){var c=a.copy();c.type=2,this.usedCells[a.y][a.x]=c,b=!0}return b},a.prototype.cellOnBoard=function(a){return a.x<this.width&&a.y<this.height&&a.x>=0&&a.y>=0},a.prototype.addPiece=function(a){var b=!1;if(this.canAddPiece(a)){for(var c=a.cells(),d=0;d<c.length;d++)this.addCell(c[d]);b=!0}return this.clearLines(),a.equals(this.fallingPiece)&&b&&this.newFallingPiece(),b},a.prototype.clearLines=function(){var a=function(){for(var a=[],b=0;10>b;b++)a[b]=new Cell(0,b,"lightgrey","empty",3);return a},b=[];this.usedCells.map(function(a,c){var d=!0;return a.map(function(a){2!==a.type&&(d=!1)}),d&&b.push(c),d}),b.length>0&&this.score.didScore(b.length);for(var c=0;c<b.length;c++)this.usedCells.splice(b[c],1),this.usedCells.unshift(a()),this.usedCells.map(function(a,b){a.map(function(a,c){a.x=c,a.y=b})})},a.prototype.canAddPiece=function(a){var b=a.cells();return this.canAddCells(b)},a.prototype.holdPiece=function(){if(!this.justHeld&&this.settings.canHold){var a=this.heldPiece;this.heldPiece=this.fallingPiece,this.heldPiece.position={x:1,y:1},this.heldPiece.rotation=0,a?this.fallingPiece=this.pieceEngine.fromHeld(a):this.newFallingPiece(),this.justHeld=!0}},a.prototype.newFallingPiece=function(){this.isGameOver()||(this.fallingPiece=this.pieceEngine.draw(),this.justHeld=!1)},a.prototype.dropFallingPiece=function(){return this.fallingPiece.dropPiece(this),this.addPiece(this.fallingPiece),this.score.didScore(0),!0},a.prototype.rotateFallingClockWise=function(){return this.fallingPiece.rotateClockWise(this)},a.prototype.rotateFallingCounterClockWise=function(){return this.fallingPiece.rotateCounterClockWise(this)},a.prototype.shiftFallingLeft=function(){return this.fallingPiece.shiftLeft(this)},a.prototype.shiftFallingRight=function(){return this.fallingPiece.shiftRight(this)},a.prototype.moveFallingDown=function(){var a=this.fallingPiece.movePieceDown(this);return a&&this.score.didScore(5),a},a.prototype.restart=function(){this.newBoard(),this.gameOver=!1,this.justHeld=!1,this.level=0,this.fallingPiece=!1,this.heldPiece=!1,this.score=new Score,this.started=!1,this.paused=!0},a.prototype.newBoard=function(){for(var a=0;a<this.height;a++){this.usedCells[a]=[];for(var b=0;b<this.width;b++)this.usedCells[a][b]=new Cell(b,a,"lightgrey","empty",3)}},a.prototype.getFallingPiece=function(){return this.fallingPiece},a.prototype.isGameOver=function(){if(!this.gameOver){var a=[this.usedCells[0],this.usedCells[1]];a.map(function(a){a.map(function(a){2===a.type&&(this.gameOver=!0)})})}return this.gameOver?void this.gameOverErr():this.gameOver},a.prototype.fromJson=function(a){return a=JSON.parse(a),this.height=a.height,this.width=a.width,this.usedCells=a.usedCells.map(function(a){return a.map(function(a){return(new Cell).fromJson(a)})}),this.settings={canHold:a.settings.canHold,useGhost:a.settings.useGhost,canPreview:a.settings.canPreview,fullScreen:a.settings.fullScreen,announcer:a.settings.announcer,useAutoSave:a.settings.useAutoSave},this.gameOver=a.gameOver,this.justHeld=a.justHeld,this.score=(new Score).fromJson(a.score),this.fallingPiece=(new this.pieceEngine.newPiece).fromJson(a.fallingPiece),this.heldPiece=a.heldPiece,this.started=a.started,this},a.prototype.gravity=function(){this.paused||this.fallingPiece&&(this.moveFallingDown()||(this.settings.useAutoSave?(window.localStorage.board=JSON.stringify(this),console.log(window.localStorage.board)):window.localStorage.board=null,this.dropFallingPiece(),document.getElementById("TetrisSong").playbackRate=this.score.getPlaybackRate(),this.playBlock(this.fallingPiece.name())))},a.prototype.pause=function(){this.gameOver&&this.paused&&this.restart(),this.started&&(this.paused=!this.paused)},new a},Cell=function(a,b,c,d,e){this.x=a?a:0,this.y=b?b:0,this.color=c?c:"lightgrey",this.name=d?d:"empty",this.type=void 0!==e?e:5};Cell.prototype.types=["ghost","moving","placed","default","offMap","unused","preview"],Cell.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.color===a.color&&this.name===a.name&&this.type===a.type},Cell.prototype.getType=function(){return Cell.prototype.types[this.type]},Cell.prototype.copy=function(){var a=new Cell(this.x,this.y,this.color,this.name,this.type);return a},Cell.prototype.collides=function(a){return this.x===a.x&&this.y===a.y},Cell.prototype.canMove=function(a,b){var c=this.copy();return c.y+=b.y,c.x+=b.x,a.canAddCell(c)},Cell.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Cell.prototype.moveDown=function(a){var b=!1;return this.canMoveDown(a)&&(this.y+=1,b=!0),b},Cell.prototype.fromJson=function(a){return void 0===a.x&&(a=JSON.parse(a)),this.x=a.x,this.y=a.y,this.color=a.color,this.name=a.name,this.type=a.type,this};var keyMappings=function(){var a={65:"a",68:"d",76:"l",82:"r",83:"s",87:"w",37:"Left",39:"Right",40:"Down",38:"Up",32:"Space",13:"Enter",16:"Shift",192:"`"},b={drop:{"function":"dropFallingPiece",english:"Drop Current Piece."},pickAlevel:{"function":"pickAlevel",english:"Use this to skip to a tetris level"},softDrop:{"function":"moveFallingDown",english:"Soft Drop Current Piece"},rotateClockWise:{"function":"rotateFallingClockWise",english:"Rotate Piece ClockWise"},rotateCounterClockWise:{"function":"rotateFallingCounterClockWise",english:"Rotate Piece Counter ClockWise"},shiftRight:{"function":"shiftFallingRight",english:"Shift Piece Right"},shiftLeft:{"function":"shiftFallingLeft",english:"Shift Piece Left"},hold:{"function":"holdPiece",english:"Hold Piece"},restart:{"function":"restart",english:"Restart Game"},pause:{"function":"pause",english:"Play / Pause Game"},changeMapping:{"function":"changeMapping",english:"Switch mapping between Arrows and wasd"}},c={keys:{87:b.drop,83:b.softDrop,39:b.rotateClockWise,37:b.rotateCounterClockWise,68:b.shiftRight,65:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}},d={keys:{40:b.softDrop,87:b.drop,38:b.rotateClockWise,39:b.shiftRight,37:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}};return{"default":c,arrows:d}};Piece.prototype.getType=function(){return Cell.prototype.types[this.type]},Piece.prototype.copy=function(){return new Piece(this.tetromino,{x:this.position.x,y:this.position.y},this.rotation,this.type)},Piece.prototype.equals=function(a){return a.type===this.type&&this.position.x===a.position.x&&this.position.y===a.position.y&&this.rotation===a.rotation},Piece.prototype.name=function(){return this.tetromino.name},Piece.prototype.color=function(){return this.tetromino.color},Piece.prototype.collides=function(a){var b=!1;return this.cells().map(function(c){a.cells().map(function(a){c.collides(a)&&(b=!0)})}),b},Piece.prototype.collidesWithCell=function(a){var b=!1;return this.cells().map(function(c){c.collides(a)&&(b=!0)}),b},Piece.prototype.collidesWithCells=function(a){for(var b=!1,c=0;c<a.length;c++)this.collidesWithCell(a[c])&&(b=!0);return b},Piece.prototype.movePiece=function(a,b){var c=!1;return this.canMove(a,b)&&(this.position.y+=b.y,this.position.x+=b.x,c=!0),c},Piece.prototype.movePieceDown=function(a){var b={x:0,y:1};return this.movePiece(a,b)},Piece.prototype.canMove=function(a,b){var c={x:this.position.x+b.x,y:this.position.y+b.y};return this.cells().map(function(d){d.canMove(a,b)||(c=!1)}),c},Piece.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Piece.prototype.canRotate=function(a,b){var c=!0,d=this.rotation;return this.rotation=b,this.cells().map(function(b){var d=a.canAddCell(b);d||(c=!1)}),this.rotation=d,c},Piece.prototype.dropPiece=function(a){for(var b=this.position.y;this.movePieceDown(a););return this.position.y===b},Piece.prototype.ghost=function(a){var b=this.copy();return b.type=0,b.dropPiece(a),b},Piece.prototype.cells=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){f.map(function(f,h){if(f){var i=new Cell(h+b.x,g+b.y,c,d,e);a.push(i)}})}),a},Piece.prototype.cells2d=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){a[g]=[],f.map(function(f,h){var i=new Cell(h+b.x,g+b.y,c,d,f?e:5);a[g].push(i)})}),a},Piece.prototype.shiftLeft=function(a){var b={x:-1,y:0};return this.movePiece(a,b)},Piece.prototype.shiftRight=function(a){var b={x:1,y:0};return this.movePiece(a,b)},Piece.prototype.rotateClockWise=function(a){var b=!1,c=this.rotation+1;return c>this.tetromino.cells.length-1&&(c=0),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.rotateCounterClockWise=function(a){var b=!1,c=this.rotation-1;return 0>c&&(c=3),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.fromJson=function(a){return void 0===a.tetromino&&(a=JSON.parse(a)),a?(this.tetromino=a.tetromino,this.rotation=a.rotation,this.position={x:a.position.x,y:a.position.y},this.type=a.type,this):!1};var allTetromino=[{cells:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],name:"I",color:"Cyan"},{cells:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],name:"J",color:"Blue"},{cells:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],name:"L",color:"#ff8c00"},{cells:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],name:"O",color:"#ffd700"},{cells:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],name:"S",color:"Green"},{cells:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],name:"T",color:"Purple"},{cells:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],name:"Z",color:"Red"}],Score=function(){this.level=0,this._score=0,this.linesCleared=0,this.singles=0,this.doubles=0,this.triples=0,this.tetrises=0,this.comboCount=0,this.lastCleared=0};Score.prototype.linesToScore=["hardDrop","single","double","triple","tetris","softDrop"],Score.prototype.single=function(){this._score+=100*(this.level+1),this.singles+=1},Score.prototype["double"]=function(){this._score+=300*(this.level+1),this.doubles+=1},Score.prototype.triple=function(){this._score+=500*(this.level+1),this.triples+=1},Score.prototype.tetris=function(){this._score+=800*(this.level+1),this.tetrises+=1},Score.prototype.combo=function(){this._score+=50*this.comboCount*this.level,this.comboCount+=1},Score.prototype.softDrop=function(){this._score+=1*(this.level+1)},Score.prototype.hardDrop=function(a){var b=2*(this.level+1)*(a+1)+20;this._score+=b},Score.prototype.levelUp=function(a){this.lastCleared+=a,(this.lastCleared>=this.levelUpFactor().lines||4===a&&this.lastCleared>=this.levelUpFactor().tetris)&&(this.lastCleared=0,this.level+=1)},Score.prototype.levelUpFactor=function(){return{lines:this.level/2*5,tetris:this.level/2*2}},Score.prototype.nextLevelUp=function(){return{linesToLevelUp:this.lastCleared+" / "+this.levelUpFactor().lines,linesFromTetris:this.lastCleared>=this.levelUpFactor().tetris}},Score.prototype.getValue=function(){return this._score},Score.prototype.getDelay=function(){return 800-50*this.level},Score.prototype.getPlaybackRate=function(){return.113*this.level+.8},Score.prototype.didScore=function(a){this.linesCleared+=5!==a?a:0,this.levelUp(5!==a?a:0),this[Score.prototype.linesToScore[a]](a)},Score.prototype.fromJson=function(a){return void 0===a.level&&(a=JSON.parse(a)),this.level=a.level,this._score=a.score,
this.linesCleared=a.linesCleared,this.singles=a.singles,this.doubles=a.doubles,this.triples=a.triples,this.tetrises=a.tetrises,this.comboCount=a.comboCount,this.lastCleared=a.lastCleared,this};var BoardEngine=function(){function a(){this.height=22,this.width=10,this.usedCells=[[]],this.newBoard(),this.settings={canHold:!0,useGhost:!0,canPreview:!0,fullScreen:!1,announcer:!0,useAutoSave:!1},this.gameOver=!1,this.paused=!0,this.justHeld=!1,this.score=new Score,this.fallingPiece=!1,this.heldPiece=!1,this.started=!1,this.pieceEngine=new PieceEngine}return a.prototype.gameOverConst="Game Over",a.prototype.gameOverErr=function(){throw this.gameOver=!0,this.gameOverConst},a.prototype.getCurrentBoard=function(){for(var a=[],b=0;b<this.height;b++){a[b]=[];for(var c=0;c<this.width;c++)a[b].push(this.usedCells[b][c].copy())}return this.fallingPiece&&(this.settings.useGhost&&this.fallingPiece.ghost(this).cells().map(function(b){a[b.y][b.x]=b.copy()}),this.fallingPiece.cells().map(function(b){a[b.y][b.x]=b.copy()})),a},a.prototype.getCell=function(a){var b=null;return this.cellOnBoard(a)?b=this.usedCells[a.y][a.x].copy():(b=new Cell(a.x,a.y),b.type=4),b},a.prototype.canAddCell=function(a){var b=this.getCell(a);return this.cellOnBoard(a)&&4!==b.type&&a.collides(b)&&3===b.type},a.prototype.canAddCells=function(a){for(var b=!0,c=0;c<a.length;c++)this.canAddCell(a[c])||(b=!1);return b},a.prototype.addCell=function(a){var b=!1;if(this.canAddCell(a)){var c=a.copy();c.type=2,this.usedCells[a.y][a.x]=c,b=!0}return b},a.prototype.cellOnBoard=function(a){return a.x<this.width&&a.y<this.height&&a.x>=0&&a.y>=0},a.prototype.addPiece=function(a){var b=!1;if(this.canAddPiece(a)){for(var c=a.cells(),d=0;d<c.length;d++)this.addCell(c[d]);b=!0}return this.clearLines(),a.equals(this.fallingPiece)&&b&&this.newFallingPiece(),b},a.prototype.clearLines=function(){var a=function(){for(var a=[],b=0;10>b;b++)a[b]=new Cell(0,b,"lightgrey","empty",3);return a},b=[];this.usedCells.map(function(a,c){var d=!0;return a.map(function(a){2!==a.type&&(d=!1)}),d&&b.push(c),d}),b.length>0&&this.score.didScore(b.length);for(var c=0;c<b.length;c++)this.usedCells.splice(b[c],1),this.usedCells.unshift(a()),this.usedCells.map(function(a,b){a.map(function(a,c){a.x=c,a.y=b})})},a.prototype.canAddPiece=function(a){var b=a.cells();return this.canAddCells(b)},a.prototype.holdPiece=function(){if(!this.justHeld&&this.settings.canHold){var a=this.heldPiece;this.heldPiece=this.fallingPiece,this.heldPiece.position={x:1,y:1},this.heldPiece.rotation=0,a?this.fallingPiece=this.pieceEngine.fromHeld(a):this.newFallingPiece(),this.justHeld=!0}},a.prototype.newFallingPiece=function(){this.isGameOver()||(this.fallingPiece=this.pieceEngine.draw(),this.justHeld=!1)},a.prototype.dropFallingPiece=function(){return this.fallingPiece.dropPiece(this),this.addPiece(this.fallingPiece),this.score.didScore(0),!0},a.prototype.rotateFallingClockWise=function(){return this.fallingPiece.rotateClockWise(this)},a.prototype.rotateFallingCounterClockWise=function(){return this.fallingPiece.rotateCounterClockWise(this)},a.prototype.shiftFallingLeft=function(){return this.fallingPiece.shiftLeft(this)},a.prototype.shiftFallingRight=function(){return this.fallingPiece.shiftRight(this)},a.prototype.moveFallingDown=function(){var a=this.fallingPiece.movePieceDown(this);return a&&this.score.didScore(5),a},a.prototype.restart=function(){this.newBoard(),this.gameOver=!1,this.justHeld=!1,this.level=0,this.fallingPiece=!1,this.heldPiece=!1,this.score=new Score,this.started=!1,this.paused=!0},a.prototype.newBoard=function(){for(var a=0;a<this.height;a++){this.usedCells[a]=[];for(var b=0;b<this.width;b++)this.usedCells[a][b]=new Cell(b,a,"lightgrey","empty",3)}},a.prototype.getFallingPiece=function(){return this.fallingPiece},a.prototype.isGameOver=function(){if(!this.gameOver){var a=[this.usedCells[0],this.usedCells[1]];a.map(function(a){a.map(function(a){2===a.type&&(this.gameOver=!0)})})}return this.gameOver?void this.gameOverErr():this.gameOver},a.prototype.fromJson=function(a){return a=JSON.parse(a),this.height=a.height,this.width=a.width,this.usedCells=a.usedCells.map(function(a){return a.map(function(a){return(new Cell).fromJson(a)})}),this.settings={canHold:a.settings.canHold,useGhost:a.settings.useGhost,canPreview:a.settings.canPreview,fullScreen:a.settings.fullScreen,announcer:a.settings.announcer,useAutoSave:a.settings.useAutoSave},this.gameOver=a.gameOver,this.justHeld=a.justHeld,this.score=(new Score).fromJson(a.score),this.fallingPiece=(new this.pieceEngine.newPiece).fromJson(a.fallingPiece),this.heldPiece=a.heldPiece,this.started=a.started,this},a.prototype.gravity=function(){this.paused||this.fallingPiece&&(this.moveFallingDown()||(this.settings.useAutoSave?(window.localStorage.board=JSON.stringify(this),console.log(window.localStorage.board)):window.localStorage.board=null,this.dropFallingPiece(),document.getElementById("TetrisSong").playbackRate=this.score.getPlaybackRate(),this.playBlock(this.fallingPiece.name())))},a.prototype.pause=function(){this.gameOver&&this.paused&&this.restart(),this.started&&(this.paused=!this.paused)},new a},Cell=function(a,b,c,d,e){this.x=a?a:0,this.y=b?b:0,this.color=c?c:"lightgrey",this.name=d?d:"empty",this.type=void 0!==e?e:5};Cell.prototype.types=["ghost","moving","placed","default","offMap","unused","preview"],Cell.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.color===a.color&&this.name===a.name&&this.type===a.type},Cell.prototype.getType=function(){return Cell.prototype.types[this.type]},Cell.prototype.copy=function(){var a=new Cell(this.x,this.y,this.color,this.name,this.type);return a},Cell.prototype.collides=function(a){return this.x===a.x&&this.y===a.y},Cell.prototype.canMove=function(a,b){var c=this.copy();return c.y+=b.y,c.x+=b.x,a.canAddCell(c)},Cell.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Cell.prototype.moveDown=function(a){var b=!1;return this.canMoveDown(a)&&(this.y+=1,b=!0),b},Cell.prototype.fromJson=function(a){return void 0===a.x&&(a=JSON.parse(a)),this.x=a.x,this.y=a.y,this.color=a.color,this.name=a.name,this.type=a.type,this};var keyMappings=function(){var a={65:"a",68:"d",76:"l",82:"r",83:"s",87:"w",37:"Left",39:"Right",40:"Down",38:"Up",32:"Space",13:"Enter",16:"Shift",192:"`"},b={drop:{"function":"dropFallingPiece",english:"Drop Current Piece."},pickAlevel:{"function":"pickAlevel",english:"Use this to skip to a tetris level"},softDrop:{"function":"moveFallingDown",english:"Soft Drop Current Piece"},rotateClockWise:{"function":"rotateFallingClockWise",english:"Rotate Piece ClockWise"},rotateCounterClockWise:{"function":"rotateFallingCounterClockWise",english:"Rotate Piece Counter ClockWise"},shiftRight:{"function":"shiftFallingRight",english:"Shift Piece Right"},shiftLeft:{"function":"shiftFallingLeft",english:"Shift Piece Left"},hold:{"function":"holdPiece",english:"Hold Piece"},restart:{"function":"restart",english:"Restart Game"},pause:{"function":"pause",english:"Play / Pause Game"},changeMapping:{"function":"changeMapping",english:"Switch mapping between Arrows and wasd"}},c={keys:{87:b.drop,83:b.softDrop,39:b.rotateClockWise,37:b.rotateCounterClockWise,68:b.shiftRight,65:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}},d={keys:{40:b.softDrop,87:b.drop,38:b.rotateClockWise,39:b.shiftRight,37:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}};return{"default":c,arrows:d}};Piece.prototype.getType=function(){return Cell.prototype.types[this.type]},Piece.prototype.copy=function(){return new Piece(this.tetromino,{x:this.position.x,y:this.position.y},this.rotation,this.type)},Piece.prototype.equals=function(a){return a.type===this.type&&this.position.x===a.position.x&&this.position.y===a.position.y&&this.rotation===a.rotation},Piece.prototype.name=function(){return this.tetromino.name},Piece.prototype.color=function(){return this.tetromino.color},Piece.prototype.collides=function(a){var b=!1;return this.cells().map(function(c){a.cells().map(function(a){c.collides(a)&&(b=!0)})}),b},Piece.prototype.collidesWithCell=function(a){var b=!1;return this.cells().map(function(c){c.collides(a)&&(b=!0)}),b},Piece.prototype.collidesWithCells=function(a){for(var b=!1,c=0;c<a.length;c++)this.collidesWithCell(a[c])&&(b=!0);return b},Piece.prototype.movePiece=function(a,b){var c=!1;return this.canMove(a,b)&&(this.position.y+=b.y,this.position.x+=b.x,c=!0),c},Piece.prototype.movePieceDown=function(a){var b={x:0,y:1};return this.movePiece(a,b)},Piece.prototype.canMove=function(a,b){var c={x:this.position.x+b.x,y:this.position.y+b.y};return this.cells().map(function(d){d.canMove(a,b)||(c=!1)}),c},Piece.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Piece.prototype.canRotate=function(a,b){var c=!0,d=this.rotation;return this.rotation=b,this.cells().map(function(b){var d=a.canAddCell(b);d||(c=!1)}),this.rotation=d,c},Piece.prototype.dropPiece=function(a){for(var b=this.position.y;this.movePieceDown(a););return this.position.y===b},Piece.prototype.ghost=function(a){var b=this.copy();return b.type=0,b.dropPiece(a),b},Piece.prototype.cells=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){f.map(function(f,h){if(f){var i=new Cell(h+b.x,g+b.y,c,d,e);a.push(i)}})}),a},Piece.prototype.cells2d=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){a[g]=[],f.map(function(f,h){var i=new Cell(h+b.x,g+b.y,c,d,f?e:5);a[g].push(i)})}),a},Piece.prototype.shiftLeft=function(a){var b={x:-1,y:0};return this.movePiece(a,b)},Piece.prototype.shiftRight=function(a){var b={x:1,y:0};return this.movePiece(a,b)},Piece.prototype.rotateClockWise=function(a){var b=!1,c=this.rotation+1;return c>this.tetromino.cells.length-1&&(c=0),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.rotateCounterClockWise=function(a){var b=!1,c=this.rotation-1;return 0>c&&(c=3),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.fromJson=function(a){return void 0===a.tetromino&&(a=JSON.parse(a)),a?(this.tetromino=a.tetromino,this.rotation=a.rotation,this.position={x:a.position.x,y:a.position.y},this.type=a.type,this):!1};var allTetromino=[{cells:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],name:"I",color:"Cyan"},{cells:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],name:"J",color:"Blue"},{cells:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],name:"L",color:"#ff8c00"},{cells:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],name:"O",color:"#ffd700"},{cells:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],name:"S",color:"Green"},{cells:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],name:"T",color:"Purple"},{cells:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],name:"Z",color:"Red"}],Score=function(){this.level=0,this._score=0,this.linesCleared=0,this.singles=0,this.doubles=0,this.triples=0,this.tetrises=0,this.comboCount=0,this.lastCleared=0};Score.prototype.linesToScore=["hardDrop","single","double","triple","tetris","softDrop"],Score.prototype.single=function(){this._score+=100*(this.level+1),this.singles+=1},Score.prototype["double"]=function(){this._score+=300*(this.level+1),this.doubles+=1},Score.prototype.triple=function(){this._score+=500*(this.level+1),this.triples+=1},Score.prototype.tetris=function(){this._score+=800*(this.level+1),this.tetrises+=1},Score.prototype.combo=function(){this._score+=50*this.comboCount*this.level,this.comboCount+=1},Score.prototype.softDrop=function(){this._score+=1*(this.level+1)},Score.prototype.hardDrop=function(a){var b=2*(this.level+1)*(a+1)+20;this._score+=b},Score.prototype.levelUp=function(a){this.lastCleared+=a,(this.lastCleared>=this.levelUpFactor().lines||4===a&&this.lastCleared>=this.levelUpFactor().tetris)&&(this.lastCleared=0,this.level+=1)},Score.prototype.levelUpFactor=function(){return{lines:this.level/2*5,tetris:this.level/2*2}},Score.prototype.nextLevelUp=function(){return{linesToLevelUp:this.lastCleared+" / "+this.levelUpFactor().lines,linesFromTetris:this.lastCleared>=this.levelUpFactor().tetris}},Score.prototype.getValue=function(){return this._score},Score.prototype.getDelay=function(){return 800-50*this.level},Score.prototype.getPlaybackRate=function(){return.113*this.level+.8},Score.prototype.didScore=function(a){this.linesCleared+=5!==a?a:0,this.levelUp(5!==a?a:0),this[Score.prototype.linesToScore[a]](a)},Score.prototype.fromJson=function(a){return void 0===a.level&&(a=JSON.parse(a)),this.level=a.level,this._score=a.score,this.linesCleared=a.linesCleared,this.singles=a.singles,this.doubles=a.doubles,this.triples=a.triples,this.tetrises=a.tetrises,this.comboCount=a.comboCount,this.lastCleared=a.lastCleared,this};var BoardEngine=function(){function a(){this.height=22,this.width=10,this.usedCells=[[]],this.newBoard(),this.settings={canHold:!0,useGhost:!0,canPreview:!0,fullScreen:!1,announcer:!0,useAutoSave:!1},this.gameOver=!1,this.paused=!0,this.justHeld=!1,this.score=new Score,this.fallingPiece=!1,this.heldPiece=!1,this.started=!1,this.pieceEngine=new PieceEngine}return a.prototype.gameOverConst="Game Over",a.prototype.gameOverErr=function(){throw this.gameOver=!0,this.gameOverConst},a.prototype.getCurrentBoard=function(){for(var a=[],b=0;b<this.height;b++){a[b]=[];for(var c=0;c<this.width;c++)a[b].push(this.usedCells[b][c].copy())}return this.fallingPiece&&(this.settings.useGhost&&this.fallingPiece.ghost(this).cells().map(function(b){a[b.y][b.x]=b.copy()}),this.fallingPiece.cells().map(function(b){a[b.y][b.x]=b.copy()})),a},a.prototype.getCell=function(a){var b=null;return this.cellOnBoard(a)?b=this.usedCells[a.y][a.x].copy():(b=new Cell(a.x,a.y),b.type=4),b},a.prototype.canAddCell=function(a){var b=this.getCell(a);return this.cellOnBoard(a)&&4!==b.type&&a.collides(b)&&3===b.type},a.prototype.canAddCells=function(a){for(var b=!0,c=0;c<a.length;c++)this.canAddCell(a[c])||(b=!1);return b},a.prototype.addCell=function(a){var b=!1;if(this.canAddCell(a)){var c=a.copy();c.type=2,this.usedCells[a.y][a.x]=c,b=!0}return b},a.prototype.cellOnBoard=function(a){return a.x<this.width&&a.y<this.height&&a.x>=0&&a.y>=0},a.prototype.addPiece=function(a){var b=!1;if(this.canAddPiece(a)){for(var c=a.cells(),d=0;d<c.length;d++)this.addCell(c[d]);b=!0}return this.clearLines(),a.equals(this.fallingPiece)&&b&&this.newFallingPiece(),b},a.prototype.clearLines=function(){var a=function(){for(var a=[],b=0;10>b;b++)a[b]=new Cell(0,b,"lightgrey","empty",3);return a},b=[];this.usedCells.map(function(a,c){var d=!0;return a.map(function(a){2!==a.type&&(d=!1)}),d&&b.push(c),d}),b.length>0&&this.score.didScore(b.length);for(var c=0;c<b.length;c++)this.usedCells.splice(b[c],1),this.usedCells.unshift(a()),this.usedCells.map(function(a,b){a.map(function(a,c){a.x=c,a.y=b})})},a.prototype.canAddPiece=function(a){var b=a.cells();return this.canAddCells(b)},a.prototype.holdPiece=function(){if(!this.justHeld&&this.settings.canHold){var a=this.heldPiece;this.heldPiece=this.fallingPiece,this.heldPiece.position={x:1,y:1},this.heldPiece.rotation=0,a?this.fallingPiece=this.pieceEngine.fromHeld(a):this.newFallingPiece(),this.justHeld=!0}},a.prototype.newFallingPiece=function(){this.isGameOver()||(this.fallingPiece=this.pieceEngine.draw(),this.justHeld=!1)},a.prototype.dropFallingPiece=function(){return this.fallingPiece.dropPiece(this),this.addPiece(this.fallingPiece),this.score.didScore(0),!0},a.prototype.rotateFallingClockWise=function(){return this.fallingPiece.rotateClockWise(this)},a.prototype.rotateFallingCounterClockWise=function(){return this.fallingPiece.rotateCounterClockWise(this)},a.prototype.shiftFallingLeft=function(){return this.fallingPiece.shiftLeft(this)},a.prototype.shiftFallingRight=function(){return this.fallingPiece.shiftRight(this)},a.prototype.moveFallingDown=function(){var a=this.fallingPiece.movePieceDown(this);return a&&this.score.didScore(5),a},a.prototype.restart=function(){this.newBoard(),this.gameOver=!1,this.justHeld=!1,this.level=0,this.fallingPiece=!1,this.heldPiece=!1,this.score=new Score,this.started=!1,this.paused=!0},a.prototype.newBoard=function(){for(var a=0;a<this.height;a++){this.usedCells[a]=[];for(var b=0;b<this.width;b++)this.usedCells[a][b]=new Cell(b,a,"lightgrey","empty",3)}},a.prototype.getFallingPiece=function(){return this.fallingPiece},a.prototype.isGameOver=function(){if(!this.gameOver){var a=[this.usedCells[0],this.usedCells[1]];a.map(function(a){a.map(function(a){2===a.type&&(this.gameOver=!0)})})}return this.gameOver?void this.gameOverErr():this.gameOver},a.prototype.fromJson=function(a){return a=JSON.parse(a),this.height=a.height,this.width=a.width,this.usedCells=a.usedCells.map(function(a){return a.map(function(a){return(new Cell).fromJson(a)})}),this.settings={canHold:a.settings.canHold,useGhost:a.settings.useGhost,canPreview:a.settings.canPreview,fullScreen:a.settings.fullScreen,announcer:a.settings.announcer,useAutoSave:a.settings.useAutoSave},this.gameOver=a.gameOver,this.justHeld=a.justHeld,this.score=(new Score).fromJson(a.score),this.fallingPiece=(new this.pieceEngine.newPiece).fromJson(a.fallingPiece),this.heldPiece=a.heldPiece,this.started=a.started,this},a.prototype.gravity=function(){this.paused||this.fallingPiece&&(this.moveFallingDown()||(this.settings.useAutoSave?(window.localStorage.board=JSON.stringify(this),console.log(window.localStorage.board)):window.localStorage.board=null,this.dropFallingPiece(),document.getElementById("TetrisSong").playbackRate=this.score.getPlaybackRate(),this.playBlock(this.fallingPiece.name())))},a.prototype.pause=function(){this.gameOver&&this.paused&&this.restart(),this.started&&(this.paused=!this.paused)},new a},Cell=function(a,b,c,d,e){this.x=a?a:0,this.y=b?b:0,this.color=c?c:"lightgrey",this.name=d?d:"empty",this.type=void 0!==e?e:5};Cell.prototype.types=["ghost","moving","placed","default","offMap","unused","preview"],Cell.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.color===a.color&&this.name===a.name&&this.type===a.type},Cell.prototype.getType=function(){return Cell.prototype.types[this.type]},Cell.prototype.copy=function(){var a=new Cell(this.x,this.y,this.color,this.name,this.type);return a},Cell.prototype.collides=function(a){return this.x===a.x&&this.y===a.y},Cell.prototype.canMove=function(a,b){var c=this.copy();return c.y+=b.y,c.x+=b.x,a.canAddCell(c)},Cell.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Cell.prototype.moveDown=function(a){var b=!1;return this.canMoveDown(a)&&(this.y+=1,b=!0),b},Cell.prototype.fromJson=function(a){return void 0===a.x&&(a=JSON.parse(a)),this.x=a.x,this.y=a.y,this.color=a.color,this.name=a.name,this.type=a.type,this};var keyMappings=function(){var a={65:"a",68:"d",76:"l",82:"r",83:"s",87:"w",37:"Left",39:"Right",40:"Down",38:"Up",32:"Space",13:"Enter",16:"Shift",192:"`"},b={drop:{"function":"dropFallingPiece",english:"Drop Current Piece."},pickAlevel:{"function":"pickAlevel",english:"Use this to skip to a tetris level"},softDrop:{"function":"moveFallingDown",english:"Soft Drop Current Piece"},rotateClockWise:{"function":"rotateFallingClockWise",english:"Rotate Piece ClockWise"},rotateCounterClockWise:{"function":"rotateFallingCounterClockWise",english:"Rotate Piece Counter ClockWise"},shiftRight:{"function":"shiftFallingRight",english:"Shift Piece Right"},shiftLeft:{"function":"shiftFallingLeft",english:"Shift Piece Left"},hold:{"function":"holdPiece",english:"Hold Piece"},restart:{"function":"restart",english:"Restart Game"},pause:{"function":"pause",english:"Play / Pause Game"},changeMapping:{"function":"changeMapping",english:"Switch mapping between Arrows and wasd"}},c={keys:{87:b.drop,83:b.softDrop,39:b.rotateClockWise,37:b.rotateCounterClockWise,68:b.shiftRight,65:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}},d={keys:{40:b.softDrop,87:b.drop,38:b.rotateClockWise,39:b.shiftRight,37:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}};return{"default":c,arrows:d}};Piece.prototype.getType=function(){return Cell.prototype.types[this.type]},Piece.prototype.copy=function(){return new Piece(this.tetromino,{x:this.position.x,y:this.position.y},this.rotation,this.type)},Piece.prototype.equals=function(a){return a.type===this.type&&this.position.x===a.position.x&&this.position.y===a.position.y&&this.rotation===a.rotation},Piece.prototype.name=function(){return this.tetromino.name},Piece.prototype.color=function(){return this.tetromino.color},Piece.prototype.collides=function(a){var b=!1;return this.cells().map(function(c){a.cells().map(function(a){c.collides(a)&&(b=!0)})}),b},Piece.prototype.collidesWithCell=function(a){var b=!1;return this.cells().map(function(c){c.collides(a)&&(b=!0)}),b},Piece.prototype.collidesWithCells=function(a){for(var b=!1,c=0;c<a.length;c++)this.collidesWithCell(a[c])&&(b=!0);return b},Piece.prototype.movePiece=function(a,b){var c=!1;return this.canMove(a,b)&&(this.position.y+=b.y,this.position.x+=b.x,c=!0),c},Piece.prototype.movePieceDown=function(a){var b={x:0,y:1};return this.movePiece(a,b)},Piece.prototype.canMove=function(a,b){var c={x:this.position.x+b.x,y:this.position.y+b.y};return this.cells().map(function(d){d.canMove(a,b)||(c=!1)}),c},Piece.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Piece.prototype.canRotate=function(a,b){var c=!0,d=this.rotation;return this.rotation=b,this.cells().map(function(b){var d=a.canAddCell(b);d||(c=!1)}),this.rotation=d,c},Piece.prototype.dropPiece=function(a){for(var b=this.position.y;this.movePieceDown(a););return this.position.y===b},Piece.prototype.ghost=function(a){var b=this.copy();return b.type=0,b.dropPiece(a),b},Piece.prototype.cells=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){f.map(function(f,h){if(f){var i=new Cell(h+b.x,g+b.y,c,d,e);a.push(i)}})}),a},Piece.prototype.cells2d=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){a[g]=[],f.map(function(f,h){var i=new Cell(h+b.x,g+b.y,c,d,f?e:5);a[g].push(i)})}),a},Piece.prototype.shiftLeft=function(a){var b={x:-1,y:0};return this.movePiece(a,b)},Piece.prototype.shiftRight=function(a){var b={x:1,y:0};return this.movePiece(a,b)},Piece.prototype.rotateClockWise=function(a){var b=!1,c=this.rotation+1;return c>this.tetromino.cells.length-1&&(c=0),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.rotateCounterClockWise=function(a){var b=!1,c=this.rotation-1;return 0>c&&(c=3),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.fromJson=function(a){return void 0===a.tetromino&&(a=JSON.parse(a)),a?(this.tetromino=a.tetromino,this.rotation=a.rotation,this.position={x:a.position.x,y:a.position.y},this.type=a.type,this):!1};var allTetromino=[{cells:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],name:"I",color:"Cyan"},{cells:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],name:"J",color:"Blue"},{cells:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],name:"L",color:"#ff8c00"},{cells:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],name:"O",color:"#ffd700"},{cells:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],name:"S",color:"Green"},{cells:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],name:"T",color:"Purple"},{cells:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],name:"Z",color:"Red"}],Score=function(){this.level=0,this._score=0,this.linesCleared=0,this.singles=0,this.doubles=0,this.triples=0,this.tetrises=0,this.comboCount=0,this.lastCleared=0};Score.prototype.linesToScore=["hardDrop","single","double","triple","tetris","softDrop"],Score.prototype.single=function(){this._score+=100*(this.level+1),this.singles+=1},Score.prototype["double"]=function(){this._score+=300*(this.level+1),this.doubles+=1},Score.prototype.triple=function(){this._score+=500*(this.level+1),this.triples+=1},Score.prototype.tetris=function(){this._score+=800*(this.level+1),this.tetrises+=1},Score.prototype.combo=function(){this._score+=50*this.comboCount*this.level,this.comboCount+=1},Score.prototype.softDrop=function(){this._score+=1*(this.level+1)},Score.prototype.hardDrop=function(a){var b=2*(this.level+1)*(a+1)+20;this._score+=b},Score.prototype.levelUp=function(a){this.lastCleared+=a,(this.lastCleared>=this.levelUpFactor().lines||4===a&&this.lastCleared>=this.levelUpFactor().tetris)&&(this.lastCleared=0,this.level+=1)},Score.prototype.levelUpFactor=function(){return{lines:this.level/2*5,tetris:this.level/2*2}},Score.prototype.nextLevelUp=function(){return{linesToLevelUp:this.lastCleared+" / "+this.levelUpFactor().lines,linesFromTetris:this.lastCleared>=this.levelUpFactor().tetris}},Score.prototype.getValue=function(){return this._score},Score.prototype.getDelay=function(){return 800-50*this.level},Score.prototype.getPlaybackRate=function(){return.113*this.level+.8},Score.prototype.didScore=function(a){this.linesCleared+=5!==a?a:0,this.levelUp(5!==a?a:0),this[Score.prototype.linesToScore[a]](a)},Score.prototype.fromJson=function(a){return void 0===a.level&&(a=JSON.parse(a)),this.level=a.level,this._score=a.score,this.linesCleared=a.linesCleared,this.singles=a.singles,this.doubles=a.doubles,this.triples=a.triples,this.tetrises=a.tetrises,this.comboCount=a.comboCount,this.lastCleared=a.lastCleared,this};var BoardEngine=function(){function a(){this.height=22,this.width=10,this.usedCells=[[]],this.newBoard(),this.settings={canHold:!0,useGhost:!0,canPreview:!0,fullScreen:!1,announcer:!0,useAutoSave:!1},this.gameOver=!1,this.paused=!0,this.justHeld=!1,this.score=new Score,this.fallingPiece=!1,this.heldPiece=!1,this.started=!1,this.pieceEngine=new PieceEngine}return a.prototype.gameOverConst="Game Over",a.prototype.gameOverErr=function(){throw this.gameOver=!0,this.gameOverConst},a.prototype.getCurrentBoard=function(){for(var a=[],b=0;b<this.height;b++){a[b]=[];for(var c=0;c<this.width;c++)a[b].push(this.usedCells[b][c].copy())}return this.fallingPiece&&(this.settings.useGhost&&this.fallingPiece.ghost(this).cells().map(function(b){a[b.y][b.x]=b.copy()}),this.fallingPiece.cells().map(function(b){a[b.y][b.x]=b.copy()})),a},a.prototype.getCell=function(a){var b=null;return this.cellOnBoard(a)?b=this.usedCells[a.y][a.x].copy():(b=new Cell(a.x,a.y),b.type=4),b},a.prototype.canAddCell=function(a){var b=this.getCell(a);return this.cellOnBoard(a)&&4!==b.type&&a.collides(b)&&3===b.type},a.prototype.canAddCells=function(a){for(var b=!0,c=0;c<a.length;c++)this.canAddCell(a[c])||(b=!1);return b},a.prototype.addCell=function(a){var b=!1;if(this.canAddCell(a)){var c=a.copy();c.type=2,this.usedCells[a.y][a.x]=c,b=!0}return b},a.prototype.cellOnBoard=function(a){return a.x<this.width&&a.y<this.height&&a.x>=0&&a.y>=0},a.prototype.addPiece=function(a){var b=!1;if(this.canAddPiece(a)){for(var c=a.cells(),d=0;d<c.length;d++)this.addCell(c[d]);b=!0}return this.clearLines(),a.equals(this.fallingPiece)&&b&&this.newFallingPiece(),b},a.prototype.clearLines=function(){var a=function(){for(var a=[],b=0;10>b;b++)a[b]=new Cell(0,b,"lightgrey","empty",3);return a},b=[];this.usedCells.map(function(a,c){var d=!0;return a.map(function(a){2!==a.type&&(d=!1)}),d&&b.push(c),d}),b.length>0&&this.score.didScore(b.length);for(var c=0;c<b.length;c++)this.usedCells.splice(b[c],1),this.usedCells.unshift(a()),this.usedCells.map(function(a,b){a.map(function(a,c){a.x=c,a.y=b})})},a.prototype.canAddPiece=function(a){var b=a.cells();return this.canAddCells(b)},a.prototype.holdPiece=function(){if(!this.justHeld&&this.settings.canHold){var a=this.heldPiece;this.heldPiece=this.fallingPiece,this.heldPiece.position={x:1,y:1},this.heldPiece.rotation=0,a?this.fallingPiece=this.pieceEngine.fromHeld(a):this.newFallingPiece(),this.justHeld=!0}},a.prototype.newFallingPiece=function(){this.isGameOver()||(this.fallingPiece=this.pieceEngine.draw(),this.justHeld=!1)},a.prototype.dropFallingPiece=function(){return this.fallingPiece.dropPiece(this),this.addPiece(this.fallingPiece),this.score.didScore(0),!0},a.prototype.rotateFallingClockWise=function(){return this.fallingPiece.rotateClockWise(this)},a.prototype.rotateFallingCounterClockWise=function(){return this.fallingPiece.rotateCounterClockWise(this)},a.prototype.shiftFallingLeft=function(){return this.fallingPiece.shiftLeft(this)},a.prototype.shiftFallingRight=function(){return this.fallingPiece.shiftRight(this)},a.prototype.moveFallingDown=function(){var a=this.fallingPiece.movePieceDown(this);return a&&this.score.didScore(5),a},a.prototype.restart=function(){this.newBoard(),this.gameOver=!1,this.justHeld=!1,this.level=0,this.fallingPiece=!1,this.heldPiece=!1,this.score=new Score,this.started=!1,this.paused=!0},a.prototype.newBoard=function(){for(var a=0;a<this.height;a++){this.usedCells[a]=[];for(var b=0;b<this.width;b++)this.usedCells[a][b]=new Cell(b,a,"lightgrey","empty",3)}},a.prototype.getFallingPiece=function(){return this.fallingPiece},a.prototype.isGameOver=function(){if(!this.gameOver){var a=[this.usedCells[0],this.usedCells[1]];a.map(function(a){a.map(function(a){2===a.type&&(this.gameOver=!0)})})}return this.gameOver?void this.gameOverErr():this.gameOver},a.prototype.fromJson=function(a){return a=JSON.parse(a),this.height=a.height,this.width=a.width,this.usedCells=a.usedCells.map(function(a){return a.map(function(a){return(new Cell).fromJson(a)})}),this.settings={canHold:a.settings.canHold,useGhost:a.settings.useGhost,canPreview:a.settings.canPreview,fullScreen:a.settings.fullScreen,announcer:a.settings.announcer,useAutoSave:a.settings.useAutoSave},this.gameOver=a.gameOver,this.justHeld=a.justHeld,this.score=(new Score).fromJson(a.score),this.fallingPiece=(new this.pieceEngine.newPiece).fromJson(a.fallingPiece),this.heldPiece=a.heldPiece,this.started=a.started,this},a.prototype.gravity=function(){this.paused||this.fallingPiece&&(this.moveFallingDown()||(this.settings.useAutoSave?(window.localStorage.board=JSON.stringify(this),console.log(window.localStorage.board)):window.localStorage.board=null,
this.dropFallingPiece(),document.getElementById("TetrisSong").playbackRate=this.score.getPlaybackRate(),this.playBlock(this.fallingPiece.name())))},a.prototype.pause=function(){this.gameOver&&this.paused&&this.restart(),this.started&&(this.paused=!this.paused)},new a},Cell=function(a,b,c,d,e){this.x=a?a:0,this.y=b?b:0,this.color=c?c:"lightgrey",this.name=d?d:"empty",this.type=void 0!==e?e:5};Cell.prototype.types=["ghost","moving","placed","default","offMap","unused","preview"],Cell.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.color===a.color&&this.name===a.name&&this.type===a.type},Cell.prototype.getType=function(){return Cell.prototype.types[this.type]},Cell.prototype.copy=function(){var a=new Cell(this.x,this.y,this.color,this.name,this.type);return a},Cell.prototype.collides=function(a){return this.x===a.x&&this.y===a.y},Cell.prototype.canMove=function(a,b){var c=this.copy();return c.y+=b.y,c.x+=b.x,a.canAddCell(c)},Cell.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Cell.prototype.moveDown=function(a){var b=!1;return this.canMoveDown(a)&&(this.y+=1,b=!0),b},Cell.prototype.fromJson=function(a){return void 0===a.x&&(a=JSON.parse(a)),this.x=a.x,this.y=a.y,this.color=a.color,this.name=a.name,this.type=a.type,this};var keyMappings=function(){var a={65:"a",68:"d",76:"l",82:"r",83:"s",87:"w",37:"Left",39:"Right",40:"Down",38:"Up",32:"Space",13:"Enter",16:"Shift",192:"`"},b={drop:{"function":"dropFallingPiece",english:"Drop Current Piece."},pickAlevel:{"function":"pickAlevel",english:"Use this to skip to a tetris level"},softDrop:{"function":"moveFallingDown",english:"Soft Drop Current Piece"},rotateClockWise:{"function":"rotateFallingClockWise",english:"Rotate Piece ClockWise"},rotateCounterClockWise:{"function":"rotateFallingCounterClockWise",english:"Rotate Piece Counter ClockWise"},shiftRight:{"function":"shiftFallingRight",english:"Shift Piece Right"},shiftLeft:{"function":"shiftFallingLeft",english:"Shift Piece Left"},hold:{"function":"holdPiece",english:"Hold Piece"},restart:{"function":"restart",english:"Restart Game"},pause:{"function":"pause",english:"Play / Pause Game"},changeMapping:{"function":"changeMapping",english:"Switch mapping between Arrows and wasd"}},c={keys:{87:b.drop,83:b.softDrop,39:b.rotateClockWise,37:b.rotateCounterClockWise,68:b.shiftRight,65:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}},d={keys:{40:b.softDrop,87:b.drop,38:b.rotateClockWise,39:b.shiftRight,37:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}};return{"default":c,arrows:d}};Piece.prototype.getType=function(){return Cell.prototype.types[this.type]},Piece.prototype.copy=function(){return new Piece(this.tetromino,{x:this.position.x,y:this.position.y},this.rotation,this.type)},Piece.prototype.equals=function(a){return a.type===this.type&&this.position.x===a.position.x&&this.position.y===a.position.y&&this.rotation===a.rotation},Piece.prototype.name=function(){return this.tetromino.name},Piece.prototype.color=function(){return this.tetromino.color},Piece.prototype.collides=function(a){var b=!1;return this.cells().map(function(c){a.cells().map(function(a){c.collides(a)&&(b=!0)})}),b},Piece.prototype.collidesWithCell=function(a){var b=!1;return this.cells().map(function(c){c.collides(a)&&(b=!0)}),b},Piece.prototype.collidesWithCells=function(a){for(var b=!1,c=0;c<a.length;c++)this.collidesWithCell(a[c])&&(b=!0);return b},Piece.prototype.movePiece=function(a,b){var c=!1;return this.canMove(a,b)&&(this.position.y+=b.y,this.position.x+=b.x,c=!0),c},Piece.prototype.movePieceDown=function(a){var b={x:0,y:1};return this.movePiece(a,b)},Piece.prototype.canMove=function(a,b){var c={x:this.position.x+b.x,y:this.position.y+b.y};return this.cells().map(function(d){d.canMove(a,b)||(c=!1)}),c},Piece.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Piece.prototype.canRotate=function(a,b){var c=!0,d=this.rotation;return this.rotation=b,this.cells().map(function(b){var d=a.canAddCell(b);d||(c=!1)}),this.rotation=d,c},Piece.prototype.dropPiece=function(a){for(var b=this.position.y;this.movePieceDown(a););return this.position.y===b},Piece.prototype.ghost=function(a){var b=this.copy();return b.type=0,b.dropPiece(a),b},Piece.prototype.cells=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){f.map(function(f,h){if(f){var i=new Cell(h+b.x,g+b.y,c,d,e);a.push(i)}})}),a},Piece.prototype.cells2d=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){a[g]=[],f.map(function(f,h){var i=new Cell(h+b.x,g+b.y,c,d,f?e:5);a[g].push(i)})}),a},Piece.prototype.shiftLeft=function(a){var b={x:-1,y:0};return this.movePiece(a,b)},Piece.prototype.shiftRight=function(a){var b={x:1,y:0};return this.movePiece(a,b)},Piece.prototype.rotateClockWise=function(a){var b=!1,c=this.rotation+1;return c>this.tetromino.cells.length-1&&(c=0),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.rotateCounterClockWise=function(a){var b=!1,c=this.rotation-1;return 0>c&&(c=3),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.fromJson=function(a){return void 0===a.tetromino&&(a=JSON.parse(a)),a?(this.tetromino=a.tetromino,this.rotation=a.rotation,this.position={x:a.position.x,y:a.position.y},this.type=a.type,this):!1};var allTetromino=[{cells:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],name:"I",color:"Cyan"},{cells:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],name:"J",color:"Blue"},{cells:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],name:"L",color:"#ff8c00"},{cells:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],name:"O",color:"#ffd700"},{cells:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],name:"S",color:"Green"},{cells:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],name:"T",color:"Purple"},{cells:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],name:"Z",color:"Red"}],Score=function(){this.level=0,this._score=0,this.linesCleared=0,this.singles=0,this.doubles=0,this.triples=0,this.tetrises=0,this.comboCount=0,this.lastCleared=0};Score.prototype.linesToScore=["hardDrop","single","double","triple","tetris","softDrop"],Score.prototype.single=function(){this._score+=100*(this.level+1),this.singles+=1},Score.prototype["double"]=function(){this._score+=300*(this.level+1),this.doubles+=1},Score.prototype.triple=function(){this._score+=500*(this.level+1),this.triples+=1},Score.prototype.tetris=function(){this._score+=800*(this.level+1),this.tetrises+=1},Score.prototype.combo=function(){this._score+=50*this.comboCount*this.level,this.comboCount+=1},Score.prototype.softDrop=function(){this._score+=1*(this.level+1)},Score.prototype.hardDrop=function(a){var b=2*(this.level+1)*(a+1)+20;this._score+=b},Score.prototype.levelUp=function(a){this.lastCleared+=a,(this.lastCleared>=this.levelUpFactor().lines||4===a&&this.lastCleared>=this.levelUpFactor().tetris)&&(this.lastCleared=0,this.level+=1)},Score.prototype.levelUpFactor=function(){return{lines:this.level/2*5,tetris:this.level/2*2}},Score.prototype.nextLevelUp=function(){return{linesToLevelUp:this.lastCleared+" / "+this.levelUpFactor().lines,linesFromTetris:this.lastCleared>=this.levelUpFactor().tetris}},Score.prototype.getValue=function(){return this._score},Score.prototype.getDelay=function(){return 800-50*this.level},Score.prototype.getPlaybackRate=function(){return.113*this.level+.8},Score.prototype.didScore=function(a){this.linesCleared+=5!==a?a:0,this.levelUp(5!==a?a:0),this[Score.prototype.linesToScore[a]](a)},Score.prototype.fromJson=function(a){return void 0===a.level&&(a=JSON.parse(a)),this.level=a.level,this._score=a.score,this.linesCleared=a.linesCleared,this.singles=a.singles,this.doubles=a.doubles,this.triples=a.triples,this.tetrises=a.tetrises,this.comboCount=a.comboCount,this.lastCleared=a.lastCleared,this};var BoardEngine=function(){function a(){this.height=22,this.width=10,this.usedCells=[[]],this.newBoard(),this.settings={canHold:!0,useGhost:!0,canPreview:!0,fullScreen:!1,announcer:!0,useAutoSave:!1},this.gameOver=!1,this.paused=!0,this.justHeld=!1,this.score=new Score,this.fallingPiece=!1,this.heldPiece=!1,this.started=!1,this.pieceEngine=new PieceEngine}return a.prototype.gameOverConst="Game Over",a.prototype.gameOverErr=function(){throw this.gameOver=!0,this.gameOverConst},a.prototype.getCurrentBoard=function(){for(var a=[],b=0;b<this.height;b++){a[b]=[];for(var c=0;c<this.width;c++)a[b].push(this.usedCells[b][c].copy())}return this.fallingPiece&&(this.settings.useGhost&&this.fallingPiece.ghost(this).cells().map(function(b){a[b.y][b.x]=b.copy()}),this.fallingPiece.cells().map(function(b){a[b.y][b.x]=b.copy()})),a},a.prototype.getCell=function(a){var b=null;return this.cellOnBoard(a)?b=this.usedCells[a.y][a.x].copy():(b=new Cell(a.x,a.y),b.type=4),b},a.prototype.canAddCell=function(a){var b=this.getCell(a);return this.cellOnBoard(a)&&4!==b.type&&a.collides(b)&&3===b.type},a.prototype.canAddCells=function(a){for(var b=!0,c=0;c<a.length;c++)this.canAddCell(a[c])||(b=!1);return b},a.prototype.addCell=function(a){var b=!1;if(this.canAddCell(a)){var c=a.copy();c.type=2,this.usedCells[a.y][a.x]=c,b=!0}return b},a.prototype.cellOnBoard=function(a){return a.x<this.width&&a.y<this.height&&a.x>=0&&a.y>=0},a.prototype.addPiece=function(a){var b=!1;if(this.canAddPiece(a)){for(var c=a.cells(),d=0;d<c.length;d++)this.addCell(c[d]);b=!0}return this.clearLines(),a.equals(this.fallingPiece)&&b&&this.newFallingPiece(),b},a.prototype.clearLines=function(){var a=function(){for(var a=[],b=0;10>b;b++)a[b]=new Cell(0,b,"lightgrey","empty",3);return a},b=[];this.usedCells.map(function(a,c){var d=!0;return a.map(function(a){2!==a.type&&(d=!1)}),d&&b.push(c),d}),b.length>0&&this.score.didScore(b.length);for(var c=0;c<b.length;c++)this.usedCells.splice(b[c],1),this.usedCells.unshift(a()),this.usedCells.map(function(a,b){a.map(function(a,c){a.x=c,a.y=b})})},a.prototype.canAddPiece=function(a){var b=a.cells();return this.canAddCells(b)},a.prototype.holdPiece=function(){if(!this.justHeld&&this.settings.canHold){var a=this.heldPiece;this.heldPiece=this.fallingPiece,this.heldPiece.position={x:1,y:1},this.heldPiece.rotation=0,a?this.fallingPiece=this.pieceEngine.fromHeld(a):this.newFallingPiece(),this.justHeld=!0}},a.prototype.newFallingPiece=function(){this.isGameOver()||(this.fallingPiece=this.pieceEngine.draw(),this.justHeld=!1)},a.prototype.dropFallingPiece=function(){return this.fallingPiece.dropPiece(this),this.addPiece(this.fallingPiece),this.score.didScore(0),!0},a.prototype.rotateFallingClockWise=function(){return this.fallingPiece.rotateClockWise(this)},a.prototype.rotateFallingCounterClockWise=function(){return this.fallingPiece.rotateCounterClockWise(this)},a.prototype.shiftFallingLeft=function(){return this.fallingPiece.shiftLeft(this)},a.prototype.shiftFallingRight=function(){return this.fallingPiece.shiftRight(this)},a.prototype.moveFallingDown=function(){var a=this.fallingPiece.movePieceDown(this);return a&&this.score.didScore(5),a},a.prototype.restart=function(){this.newBoard(),this.gameOver=!1,this.justHeld=!1,this.level=0,this.fallingPiece=!1,this.heldPiece=!1,this.score=new Score,this.started=!1,this.paused=!0},a.prototype.newBoard=function(){for(var a=0;a<this.height;a++){this.usedCells[a]=[];for(var b=0;b<this.width;b++)this.usedCells[a][b]=new Cell(b,a,"lightgrey","empty",3)}},a.prototype.getFallingPiece=function(){return this.fallingPiece},a.prototype.isGameOver=function(){if(!this.gameOver){var a=[this.usedCells[0],this.usedCells[1]];a.map(function(a){a.map(function(a){2===a.type&&(this.gameOver=!0)})})}return this.gameOver?void this.gameOverErr():this.gameOver},a.prototype.fromJson=function(a){return a=JSON.parse(a),this.height=a.height,this.width=a.width,this.usedCells=a.usedCells.map(function(a){return a.map(function(a){return(new Cell).fromJson(a)})}),this.settings={canHold:a.settings.canHold,useGhost:a.settings.useGhost,canPreview:a.settings.canPreview,fullScreen:a.settings.fullScreen,announcer:a.settings.announcer,useAutoSave:a.settings.useAutoSave},this.gameOver=a.gameOver,this.justHeld=a.justHeld,this.score=(new Score).fromJson(a.score),this.fallingPiece=(new this.pieceEngine.newPiece).fromJson(a.fallingPiece),this.heldPiece=a.heldPiece,this.started=a.started,this},a.prototype.gravity=function(){this.paused||this.fallingPiece&&(this.moveFallingDown()||(this.settings.useAutoSave?(window.localStorage.board=JSON.stringify(this),console.log(window.localStorage.board)):window.localStorage.board=null,this.dropFallingPiece(),document.getElementById("TetrisSong").playbackRate=this.score.getPlaybackRate(),this.playBlock(this.fallingPiece.name())))},a.prototype.pause=function(){this.gameOver&&this.paused&&this.restart(),this.started&&(this.paused=!this.paused)},new a},Cell=function(a,b,c,d,e){this.x=a?a:0,this.y=b?b:0,this.color=c?c:"lightgrey",this.name=d?d:"empty",this.type=void 0!==e?e:5};Cell.prototype.types=["ghost","moving","placed","default","offMap","unused","preview"],Cell.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.color===a.color&&this.name===a.name&&this.type===a.type},Cell.prototype.getType=function(){return Cell.prototype.types[this.type]},Cell.prototype.copy=function(){var a=new Cell(this.x,this.y,this.color,this.name,this.type);return a},Cell.prototype.collides=function(a){return this.x===a.x&&this.y===a.y},Cell.prototype.canMove=function(a,b){var c=this.copy();return c.y+=b.y,c.x+=b.x,a.canAddCell(c)},Cell.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Cell.prototype.moveDown=function(a){var b=!1;return this.canMoveDown(a)&&(this.y+=1,b=!0),b},Cell.prototype.fromJson=function(a){return void 0===a.x&&(a=JSON.parse(a)),this.x=a.x,this.y=a.y,this.color=a.color,this.name=a.name,this.type=a.type,this};var keyMappings=function(){var a={65:"a",68:"d",76:"l",82:"r",83:"s",87:"w",37:"Left",39:"Right",40:"Down",38:"Up",32:"Space",13:"Enter",16:"Shift",192:"`"},b={drop:{"function":"dropFallingPiece",english:"Drop Current Piece."},pickAlevel:{"function":"pickAlevel",english:"Use this to skip to a tetris level"},softDrop:{"function":"moveFallingDown",english:"Soft Drop Current Piece"},rotateClockWise:{"function":"rotateFallingClockWise",english:"Rotate Piece ClockWise"},rotateCounterClockWise:{"function":"rotateFallingCounterClockWise",english:"Rotate Piece Counter ClockWise"},shiftRight:{"function":"shiftFallingRight",english:"Shift Piece Right"},shiftLeft:{"function":"shiftFallingLeft",english:"Shift Piece Left"},hold:{"function":"holdPiece",english:"Hold Piece"},restart:{"function":"restart",english:"Restart Game"},pause:{"function":"pause",english:"Play / Pause Game"},changeMapping:{"function":"changeMapping",english:"Switch mapping between Arrows and wasd"}},c={keys:{87:b.drop,83:b.softDrop,39:b.rotateClockWise,37:b.rotateCounterClockWise,68:b.shiftRight,65:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}},d={keys:{40:b.softDrop,87:b.drop,38:b.rotateClockWise,39:b.shiftRight,37:b.shiftLeft,16:b.hold,13:b.restart,32:b.pause,192:b.changeMapping,76:b.pickAlevel,readableLine:function(b){var c;return void 0!==this[b]&&(c=a[b]+" = "+this[b].english),c},readableLines:function(){for(var a=[],b=0;200>b;b++)this.readableLine(b)&&a.push(this.readableLine(b));return a}}};return{"default":c,arrows:d}};Piece.prototype.getType=function(){return Cell.prototype.types[this.type]},Piece.prototype.copy=function(){return new Piece(this.tetromino,{x:this.position.x,y:this.position.y},this.rotation,this.type)},Piece.prototype.equals=function(a){return a.type===this.type&&this.position.x===a.position.x&&this.position.y===a.position.y&&this.rotation===a.rotation},Piece.prototype.name=function(){return this.tetromino.name},Piece.prototype.color=function(){return this.tetromino.color},Piece.prototype.collides=function(a){var b=!1;return this.cells().map(function(c){a.cells().map(function(a){c.collides(a)&&(b=!0)})}),b},Piece.prototype.collidesWithCell=function(a){var b=!1;return this.cells().map(function(c){c.collides(a)&&(b=!0)}),b},Piece.prototype.collidesWithCells=function(a){for(var b=!1,c=0;c<a.length;c++)this.collidesWithCell(a[c])&&(b=!0);return b},Piece.prototype.movePiece=function(a,b){var c=!1;return this.canMove(a,b)&&(this.position.y+=b.y,this.position.x+=b.x,c=!0),c},Piece.prototype.movePieceDown=function(a){var b={x:0,y:1};return this.movePiece(a,b)},Piece.prototype.canMove=function(a,b){var c={x:this.position.x+b.x,y:this.position.y+b.y};return this.cells().map(function(d){d.canMove(a,b)||(c=!1)}),c},Piece.prototype.canMoveDown=function(a){return this.canMove(a,{x:0,y:1})},Piece.prototype.canRotate=function(a,b){var c=!0,d=this.rotation;return this.rotation=b,this.cells().map(function(b){var d=a.canAddCell(b);d||(c=!1)}),this.rotation=d,c},Piece.prototype.dropPiece=function(a){for(var b=this.position.y;this.movePieceDown(a););return this.position.y===b},Piece.prototype.ghost=function(a){var b=this.copy();return b.type=0,b.dropPiece(a),b},Piece.prototype.cells=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){f.map(function(f,h){if(f){var i=new Cell(h+b.x,g+b.y,c,d,e);a.push(i)}})}),a},Piece.prototype.cells2d=function(){var a=[],b=this.position,c=this.color(),d=this.name(),e=this.type;return this.tetromino.cells[this.rotation].map(function(f,g){a[g]=[],f.map(function(f,h){var i=new Cell(h+b.x,g+b.y,c,d,f?e:5);a[g].push(i)})}),a},Piece.prototype.shiftLeft=function(a){var b={x:-1,y:0};return this.movePiece(a,b)},Piece.prototype.shiftRight=function(a){var b={x:1,y:0};return this.movePiece(a,b)},Piece.prototype.rotateClockWise=function(a){var b=!1,c=this.rotation+1;return c>this.tetromino.cells.length-1&&(c=0),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.rotateCounterClockWise=function(a){var b=!1,c=this.rotation-1;return 0>c&&(c=3),this.canRotate(a,c)&&(this.rotation=c,b=!0),b},Piece.prototype.fromJson=function(a){return void 0===a.tetromino&&(a=JSON.parse(a)),a?(this.tetromino=a.tetromino,this.rotation=a.rotation,this.position={x:a.position.x,y:a.position.y},this.type=a.type,this):!1};var allTetromino=[{cells:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],name:"I",color:"Cyan"},{cells:[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],name:"J",color:"Blue"},{cells:[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],name:"L",color:"#ff8c00"},{cells:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],name:"O",color:"#ffd700"},{cells:[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],name:"S",color:"Green"},{cells:[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],name:"T",color:"Purple"},{cells:[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],name:"Z",color:"Red"}],Score=function(){this.level=0,this._score=0,this.linesCleared=0,this.singles=0,this.doubles=0,this.triples=0,this.tetrises=0,this.comboCount=0,this.lastCleared=0};Score.prototype.linesToScore=["hardDrop","single","double","triple","tetris","softDrop"],Score.prototype.single=function(){this._score+=100*(this.level+1),this.singles+=1},Score.prototype["double"]=function(){this._score+=300*(this.level+1),this.doubles+=1},Score.prototype.triple=function(){this._score+=500*(this.level+1),this.triples+=1},Score.prototype.tetris=function(){this._score+=800*(this.level+1),this.tetrises+=1},Score.prototype.combo=function(){this._score+=50*this.comboCount*this.level,this.comboCount+=1},Score.prototype.softDrop=function(){this._score+=1*(this.level+1)},Score.prototype.hardDrop=function(a){var b=2*(this.level+1)*(a+1)+20;this._score+=b},Score.prototype.levelUp=function(a){this.lastCleared+=a,(this.lastCleared>=this.levelUpFactor().lines||4===a&&this.lastCleared>=this.levelUpFactor().tetris)&&(this.lastCleared=0,this.level+=1)},Score.prototype.levelUpFactor=function(){return{lines:this.level/2*5,tetris:this.level/2*2}},Score.prototype.nextLevelUp=function(){return{linesToLevelUp:this.lastCleared+" / "+this.levelUpFactor().lines,linesFromTetris:this.lastCleared>=this.levelUpFactor().tetris}},Score.prototype.getValue=function(){return this._score},Score.prototype.getDelay=function(){return 800-50*this.level},Score.prototype.getPlaybackRate=function(){return.113*this.level+.8},Score.prototype.didScore=function(a){this.linesCleared+=5!==a?a:0,this.levelUp(5!==a?a:0),this[Score.prototype.linesToScore[a]](a)},Score.prototype.fromJson=function(a){return void 0===a.level&&(a=JSON.parse(a)),this.level=a.level,this._score=a.score,this.linesCleared=a.linesCleared,this.singles=a.singles,this.doubles=a.doubles,this.triples=a.triples,this.tetrises=a.tetrises,this.comboCount=a.comboCount,this.lastCleared=a.lastCleared,this};